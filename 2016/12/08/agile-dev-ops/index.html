<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Agile Dev Ops</title>

    <!-- Bootstrap Core CSS -->
    <link href="/stylesheets/bootstrap.min.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Kaushan+Script" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link href="/stylesheets/site.css" rel="stylesheet" />
    <script src="/javascripts/all.js"></script>
    <link href="/images/favicon.ico" rel="icon" type="image/ico" />

</head>
<body class="x2016 x2016_12 x2016_12_08 x2016_12_08_agile-dev-ops x2016_12_08_agile-dev-ops_index">
    <link href="/stylesheets/highlighting.css" rel="stylesheet" />
<!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand page-scroll" href="/#page-top"><img width="175" src="/images/av-logo-inverse.png" /></a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li class="hidden">
                        <a href="/#page-top"></a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#services">Why us?</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#portfolio">Case Studies</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#about">About</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#subscribe">Subscribe</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#contact">Contact</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>
<section id="blog">
  <div class="container">
    <div class="row">
      <div class="col-lg-2">
      </div>
      <div class="col-lg-8 text-left">
        <h2 class='title'><a href="/2016/12/08/agile-dev-ops/">Agile Dev Ops</a></h2>
        <h5 class='date'> 8 Dec 2016</h5>
    <p>So my project manager partner for WebsiteOne Raoul has got really busy recently, so we negotiated that I would take on some of the PR merging and release responsibility this week.  After the usual blogging and admin and &ldquo;Martin Fowler&rdquo; scrum I jumped into a hangout with Matt and Michael, and tried to use the opportunity to debug the YouTube hookup problems Matt had been having the day before.  This time Matt was getting a new error that he couldn&rsquo;t even start a Hangout On Air, so we couldn&rsquo;t get far.  Burned 20 minutes on that, although it&rsquo;s a fairly common issue our users have, and if we could fix it then we could get more video broadcasts and streaming of other pairing sessions.  Then again I don&rsquo;t know that our YouTube activity is driving much traffic to our site; it doesn&rsquo;t register in Google analytics.  Although people might just be typing in searches direct for &ldquo;AgileVentures&rdquo;, but I&rsquo;ve yet to hear anyone say &ldquo;Oh, I saw your pairing video on YouTube and wanted to get involved&rdquo;.  The viewing figures on our videos are spiking (the pair programming session I started with Matt and Michael has 333 views today, 5 thumbs up AND 5 thumbs down!).  However, even anecdotally the Ruby Rogues podcast has generated more traffic than all our YouTube activity combined.  Still the YouTube recordings are at least partly for the benefit of the existing community, to allow them to refer back to previous pairing sessions.</p>

<p>Alot of the WebsiteOne infrastructure is set up around supporting Google Hangouts and YouTube streams.  Matt and Michael had got in a Work in Progress pull request that added a characterisation test to the tweeting of YouTube links that was missing an acceptance test.  This was related to trying to fix a long standing issue that our system tweets video links even when the videos are missing.  We&rsquo;d previously backed off the bigger fix to ensure the current functionality was described in an acceptance test.  I needed to get on to WSO devops and needed to give Matt and Michael feedback without jumping in and trying to fix lots of things.  At least that was my strategy as I reviewed their code.  They had filtered the sensitive Twitter tokens from the VCR cache, which was great, but I had two concerns with the new acceptance test below:</p>
<pre class="highlight gherkin"><code><span class="nt">@vcr</span>
<span class="kd">Feature</span><span class="p">:</span> Tweeting Live Events
  As a site admin
  In order to increase participation in events
  I would like live events to generate twitter notifications

  <span class="kn">Background</span><span class="p">:</span>
    <span class="nf">Given</span> an event exists

  <span class="kn">Scenario</span><span class="p">:</span> Event going live causes tweets of hangout link and youtube link to be sent
    <span class="nf">When</span> the HangoutConnection has pinged to indicate the event start, appropriate tweets will be sent
</code></pre>
<p>One was that we had all the work being done in a single Cucumber step, which was also bound quite tightly to the underlying implementation:</p>
<pre class="highlight ruby"><code><span class="no">When</span><span class="p">(</span><span class="sr">/^the HangoutConnection has pinged to indicate the event start, appropriate tweets will be sent$/</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">yt_tweet</span> <span class="o">=</span> <span class="s2">"Alejandro just hosted an online #scrum Missed it? Catch the recording at youtu.be/11 #CodeForGood #opensource"</span>
  <span class="n">hangout_tweet</span> <span class="o">=</span> <span class="s2">"#Scrum meeting with our #distributedteam is live on http://hangout.test Join in and learn about our #opensource #projects!"</span>
   <span class="n">expect</span><span class="p">(</span><span class="no">TwitterService</span><span class="p">.</span><span class="nf">twitter_client</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:update</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="n">hangout_tweet</span><span class="p">).</span><span class="nf">and_call_original</span>
  <span class="n">expect</span><span class="p">(</span><span class="no">TwitterService</span><span class="p">.</span><span class="nf">twitter_client</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:update</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="n">yt_tweet</span><span class="p">).</span><span class="nf">and_call_original</span>

  <span class="n">participants</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"0"</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">"id"</span><span class="o">=&gt;</span><span class="s2">"hangout2750757B_ephemeral.id.google.com^a85dcb4670"</span><span class="p">,</span> <span class="s2">"hasMicrophone"</span><span class="o">=&gt;</span><span class="s2">"true"</span><span class="p">,</span> <span class="s2">"hasCamera"</span><span class="o">=&gt;</span><span class="s2">"true"</span><span class="p">,</span> <span class="s2">"hasAppEnabled"</span><span class="o">=&gt;</span><span class="s2">"true"</span><span class="p">,</span> <span class="s2">"isBroadcaster"</span><span class="o">=&gt;</span><span class="s2">"true"</span><span class="p">,</span> <span class="s2">"isInBroadcast"</span><span class="o">=&gt;</span><span class="s2">"true"</span><span class="p">,</span> <span class="s2">"displayIndex"</span><span class="o">=&gt;</span><span class="s2">"0"</span><span class="p">,</span> <span class="s2">"person"</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">"id"</span><span class="o">=&gt;</span><span class="s2">"108533475599002820142"</span><span class="p">,</span> <span class="s2">"displayName"</span><span class="o">=&gt;</span><span class="s2">"Alejandro Babio"</span><span class="p">,</span> <span class="s2">"image"</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">"url"</span><span class="o">=&gt;</span><span class="s2">"https://lh4.googleusercontent.com/-p4ahDFi9my0/AAAAAAAAAAI/AAAAAAAAAAA/n-WK7pTcJa0/s96-c/photo.jpg"</span><span class="p">},</span> <span class="s2">"na"</span><span class="o">=&gt;</span><span class="s2">"false"</span><span class="p">},</span> <span class="s2">"locale"</span><span class="o">=&gt;</span><span class="s2">"en"</span><span class="p">,</span> <span class="s2">"na"</span><span class="o">=&gt;</span><span class="s2">"false"</span><span class="p">}}</span>
  <span class="n">header</span> <span class="s1">'ORIGIN'</span><span class="p">,</span> <span class="s1">'a-hangout-opensocial.googleusercontent.com'</span>
  <span class="n">put</span> <span class="s2">"/hangouts/@google_id"</span><span class="p">,</span> <span class="p">{</span><span class="ss">title: </span><span class="vi">@event</span><span class="p">.</span><span class="nf">name</span><span class="p">,</span> 
                               <span class="ss">host_id: </span><span class="s1">'3'</span><span class="p">,</span> 
                               <span class="ss">event_id: </span><span class="vi">@event</span><span class="p">.</span><span class="nf">id</span><span class="p">,</span>
                               <span class="ss">participants: </span><span class="n">participants</span><span class="p">,</span> 
                               <span class="ss">hangout_url: </span><span class="s1">'http://hangout.test'</span><span class="p">,</span>
                               <span class="ss">hoa_status: </span><span class="s1">'live'</span><span class="p">,</span> 
                               <span class="ss">project_id: </span><span class="s1">'1'</span><span class="p">,</span> 
                               <span class="ss">category: </span><span class="s1">'Scrum'</span><span class="p">,</span>
                               <span class="ss">yt_video_id: </span><span class="s1">'11'</span><span class="p">}</span>
<span class="k">end</span>
</code></pre>
<p>The challenge we had here was that we wanted to check the Tweets were sent, but that we were locking our acceptance test to the specific implementation of our TwitterService object.  A reasonable compromise for the time being perhaps, but could we use an RSpec spy on TwitterService to allow us to break the step into two and into a readable order?  Or was there some way to assert that the VCR cache had been hit in the appropriate fashion?  Both, things that could be investigated immediately.  I almost had the Rails console out, but pulled myself back, suggested to Matt and Michael that they just clean up some stray steps and scenarios and get this PR in.  We didn&rsquo;t have unlimited time right now to look for a perfect test.  Some test was better than no test, which was the state we had been in before.</p>

<p>Matt and Michael went off to another hangout and I got on with WSO devops.  I had been hoping to review the waffle board (project management) but only got so far as reviewing all the outstanding PRs.  I merged in the Premium controller refactoring PR that Michael and I had worked on, and checked that on the develop server - all good.  I looked to see what was in the hopper for deploying to production, and it wasn&rsquo;t so much, so I decided to try and pull in the new PayPal integration as well.  I fell foul of merge conflicts and clobberings that I had anticipated when we broke out the separate PR for the refacotoring.  Frustrating, although I think I only burned an additional 30 minutes there.   Not sure if that was time well spent.</p>

<p>I was making a mess on my local system, but the CI was passing, and it looked like we were ready to go, but then the controller specific stylesheets that I had been struggling with the day before were not working on production.  It seemed like they were not playing well with the asset pipeline.  All I was trying to do was to isolate the style for centering and add margin to the payment option wells.  Without they looked like this:</p>

<p><img src="https://www.dropbox.com/s/3juob156frv89te/Screenshot%202016-12-08%2010.09.19.png?dl=1" /></p>

<p>With they looked like this:</p>

<p><img src="https://www.dropbox.com/s/o2tgyq1df0bls9y/Screenshot%202016-12-08%2010.09.57.png?dl=1" /></p>

<p>I&rsquo;d spent an hour struggling to get that to work the previous day.  What should I do?  Just push out what we had?  Burn time fixing them up? I tried to recreate the issue locally by running the local server in production mode, fighting through the nest of environment variables that production needed to run: </p>
<pre class="highlight plaintext"><code>SECRET_KEY_BASE=asdfggfhdgs SECRET_TOKEN=12342ewwefdsaf AIRBRAKE_API_KEY=asdffgfhdgsf AIRBRAKE_PROJECT_ID=2342 be rails s -e production
</code></pre>
<p>but even then the local stylesheets wouldn&rsquo;t load at all.  I&rsquo;d spent 20 minutes and couldn&rsquo;t replicate the bug locally.  In frustration I shiv&rsquo;d in the necessary styles, because I anticipated the debug cycle checking for fixes in production mode on the develop server would be prohibitive:</p>
<pre class="highlight html"><code>  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"card_section"</span> <span class="na">class=</span><span class="s">"col-lg-5 well"</span> <span class="na">style=</span><span class="s">"margin: 10px; text-align: center;"</span><span class="nt">&gt;</span> <span class="c">&lt;!-- shiv because controller stylesheets now working in production mode see https://github.com/AgileVentures/WebsiteOne/issues/1450--&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"margin-bottom: 15px;"</span><span class="nt">&gt;</span>Get Premium via Credit/Debit Card:<span class="nt">&lt;/div&gt;</span>
    <span class="err">&lt;</span>%= form_tag subscriptions_path(plan: 'premium') do %&gt;
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://checkout.stripe.com/checkout.js"</span> <span class="na">class=</span><span class="s">"stripe-button"</span>
                <span class="na">data-key=</span><span class="s">"&lt;%= Rails.configuration.stripe[:publishable_key] %&gt;"</span>
                <span class="na">data-description=</span><span class="s">"A month's subscription"</span>
                <span class="na">data-amount=</span><span class="s">"1000"</span>
                <span class="na">data-currency=</span><span class="s">"GBP"</span>
                <span class="na">data-locale=</span><span class="s">"en-US"</span>
                <span class="na">data-name=</span><span class="s">"Premium Membership"</span>
                <span class="na">data-label=</span><span class="s">"Subscribe"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="err">&lt;</span>% end %&gt;

  <span class="nt">&lt;/div&gt;</span>
</code></pre>
<p>At least I linked the ticket in to the comment, and hope we can circle back to fix that properly, although what it really inspires me to do is move the whole system to a static middleman app where we take a fresh start on the styling.  I pushed on.  There were still some <a href="https://github.com/AgileVentures/WebsiteOne/issues/1451">problems on staging</a> that I think are related to the data there, and brittleness in parts of the app.  That needs fixing, since it interferes with our ability to do manual checks on staging; but I pushed on and was ultimately rewarded with the newly styled PayPal endpoint on production, and I hurredly fixed up all the static pages to ensure that they pointed to the new &lsquo;subscriptions&rsquo; endpoint.</p>

<p>Agile DevOps?  I&rsquo;d managed to negotiate a handover from my project-manager pair and get the first part of a bigger epic of PayPal integration out onto production.  I&rsquo;d had to make several compromises along the way, but at least I&rsquo;d flagged them with tickets, and thought I&rsquo;d got a good insight into some of the problems facing us.  I still wonder if we really have performance issues?  The site feels sluggish, but perhaps the 150% memory error warnings from Heroku are just part of their sales strategy.  I am leaning towards an alternate approach where we have a middleman site for the main system, and things like events and projects can be pulled in via JavaScript of separate RESTful API endpoints.  This would mean that heavy load in one part of the site would not affect simple loading of about pages, and also allow the back ends of the different elements of the site to be compartmentalized and chopped and changed as necessary.  It would be a big change, but we&rsquo;re already creating the individual microservices - let&rsquo;s see how we go.  If we can move to the real model I think we really will have done Agile DevOps!</p>

<h3>Related Videos:</h3>

<ul>
<li><a href="https://www.youtube.com/watch?v=dxImOJLvadE">&ldquo;Martin Fowler&rdquo; Scrum</a></li>
<li><a href="https://www.youtube.com/watch?v=VK9qIJwXG1g">Pair Programming and DevOps on WSO</a></li>
<li><a href="https://www.youtube.com/watch?v=uQErOajwgt4">&ldquo;Kent Beck&rdquo; Scrum</a></li>
</ul>

        <h2 class='author'>by Sam Joseph</h2>
      </div>  
      <div class="col-lg-2">
      </div>
    </div>  
  </div>  
</section>  
<footer>
    <div class="container">
        <section id="contact">
        <div class="row">
            <div class="col-md-4">
                <h3>AgileVentures</h3>
                <p class="blurb text-muted">Our purpose is to develop better more affordable software solutions to enable non-profits to be more effective and more efficient. We also host a <a href="http://www.agileventures.org">learning community</a> around <a href="https://www.edx.org/xseries/agile-development-using-ruby-rails">free online courses</a> that enable developers to improve their team and software skills, and then to apply them on socially useful projects for non-profits. We are a Charitable Incorporated Organisation (CIO) in the UK. Ref #1170963</p>
            </div>
            <div class="col-md-4">
                <h3>What we do</h3>
                <div class="list">
                    <i class="fa fa-check fa-lg fa-text"><span class='font-override'>&nbsp;&nbsp;Websites</span></i>
                    <i class="fa fa-check fa-lg fa-text"><span class='font-override'>&nbsp;&nbsp;Apps</span></i>
                    <i class="fa fa-check fa-lg fa-text"><span class='font-override'>&nbsp;&nbsp;Process Automation</span></i>
                    <i class="fa fa-check fa-lg fa-text"><span class='font-override'>&nbsp;&nbsp;Software Projects</span></i>
                </div>
                <h4>More on our <a href="/blog">Blog</a></h4>
            </div>
            <div class="col-md-4">
                <h3>Contact Us</h3>
                <div class="contact-list">
                  <!-- <i class="fa fa-envelope fa-lg fa-text fa-fw"><span class='font-override'>&nbsp;&nbsp;</i> -->
                  <i class="fa fa-lg fa-text"><a class='mail' href='mailto:nonprofits@agileventures.org'>nonprofits@<wbr>agileventures.org</a></span></i>
                  <i class="fa fa-lg fa-text"><span class='font-override'>AgileVentures</span></i>
                  <!-- <i class="fa fa-map-marker fa-lg fa-text fa-fw"></i> -->
                  <i class="fa fa-lg fa-text"><span class='font-override'>The Lodge</span></i>
                  <i class="fa fa-lg fa-text"><span class='font-override'>64 Pinner Road</span></i>
                  <i class="fa fa-lg fa-text"><span class='font-override'>Harrow, HA1 4HZ</span></i>
                </div>
            </div>
        </div>
        </section>
        <div class="row">
            <div class="col-md-4">
                <ul class="list-inline quicklinks">
                    <li><a href="/privacy">Privacy Policy</a>
                    </li>
                    <li><a href="/terms">Terms of Use</a>
                    </li>
                </ul>
            </div>
            <div class="col-md-4">
                <span class="copyright">Copyright &copy; AgileVentures 2017</span>
            </div>
            <div class="col-md-4">
                <ul class="list-inline social-buttons">
                    <li><a href="https://twitter.com/AgileVentures"><i class="fa fa-twitter"></i></a>
                    </li>
                    <li><a href="https://www.facebook.com/agileventures"><i class="fa fa-facebook"></i></a>
                    </li>
                    <li><a href="https://www.linkedin.com/company/agileventures"><i class="fa fa-linkedin"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    </section>
</footer>


</body>
</html>
