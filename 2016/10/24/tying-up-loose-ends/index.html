<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Tying Up Loose Ends</title>

    <!-- Bootstrap Core CSS -->
    <link href="/stylesheets/bootstrap.min.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Kaushan+Script" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link href="/stylesheets/site.css" rel="stylesheet" />
    <script src="/javascripts/all.js"></script>
    <link href="/images/favicon.ico" rel="icon" type="image/ico" />

</head>
<body class="x2016 x2016_10 x2016_10_24 x2016_10_24_tying-up-loose-ends x2016_10_24_tying-up-loose-ends_index">
    <link href="/stylesheets/highlighting.css" rel="stylesheet" />
<!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand page-scroll" href="/#page-top"><img width="175" src="/images/av-logo-inverse.png" /></a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li class="hidden">
                        <a href="/#page-top"></a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#services">Why us?</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#portfolio">Case Studies</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#about">About</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#subscribe">Subscribe</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#contact">Contact</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>
<section id="blog">
  <div class="container">
    <div class="row">
      <div class="col-lg-2">
      </div>
      <div class="col-lg-8 text-left">
        <h2 class='title'><a href="/2016/10/24/tying-up-loose-ends/">Tying Up Loose Ends</a></h2>
        <h5 class='date'>24 Oct 2016</h5>
    <p>So after <a href="http://nonprofits.agileventures.org/2016/10/21/yak-shaving/">Yak shaving</a> with Heroku automated PR deploys, we finally got it working.  Raoul joined us in the &ldquo;Martin Fowler&rdquo; scrum and through a process of both disabling the PR deploys, AND deleting the GitHub webhooks that Heroku had installed, the permissions issue was resolved.  The deploys themselves were now marked on GitHub as coming from me, and suddenly all the other strange database issues evaporated.  I did also get a reply from Heroku:</p>

<blockquote>
<p>The use of ruby-2.3.0 appears to be because you&rsquo;re bundling it into the vendor/ directory:</p>
</blockquote>
<pre class="highlight plaintext"><code>$ ls vendor/*/*

[…]

vendor/bundle/ruby:
2.3.0
</code></pre>
<blockquote>
<p>We advise against checking vendor into source control, and relying solely on bundler&rsquo;s installation of Gemfile contents instead.</p>

<p>The Postgres error appears to be because your database.yml hard codes some connection information:</p>
</blockquote>
<pre class="highlight plaintext"><code>development: &amp;dev
  adapter: postgresql
  encoding: unicode
  database: websiteone_development
  pool: 20
  username: postgres
  password:

[…]

production:
  &lt;&lt;: *dev
  database: websiteone_production
As you can see in the error, the error is that the postgres user attempts to connect, and fails. After it fails, Rails falls back to the value located in $DATABASE_URL. You can change this to simply:

production:
  url: &lt;%= ENV['DATABASE_URL'] %&gt;
</code></pre>
<p>which all sounded like good advice, but this was all for errors that were no longer occurring - at least if they were, they were no longer blocking the deploy.  I asked them about that:</p>

<blockquote>
<p>Thanks Jason, that&rsquo;s weird because we don&rsquo;t have vendor/bundle/ruby in our source tree: https://github.com/AgileVentures/WebsiteOne/tree/develop/vendor/ any idea how it&rsquo;s getting in there during deploy?</p>
</blockquote>

<p>and I got back the following:</p>

<blockquote>
<p>Regarding the vendor/bundle/ruby question I think there may have been some issue with the build cache on this occasion that was holding the 2.3.0 over from a previous deploy. If you have any trouble in future you could you try running the following commands:</p>
</blockquote>
<pre class="highlight plaintext"><code>$ heroku plugins:install https://github.com/heroku/heroku-repo.git
$ heroku repo:purge_cache -a appname
$ git commit --allow-empty -m "Purge cache"
$ git push heroku master
</code></pre>
<blockquote>
<p>That will ensure you start from a cold cache for that deploy. Let me know if you have any further questions.</p>
</blockquote>

<p>So that&rsquo;s that, except that all these automated PR apps are costing us money, and I&rsquo;m not sure they are being deployed automatically.  The LocalSupport auto-deploy appears to be stuck due to an app limit of 100, and I&rsquo;m starting to suspect that&rsquo;s because the local support develop server is on my personal account.  If I move it to one of our group accounts we&rsquo;ll start incurring more charges, so I found a little script to <a href="https://gist.github.com/naaman/1384970">delete heroku apps in batch</a>, which I modified slightly to work with a hand picked list:</p>
<pre class="highlight plaintext"><code>while read app; do heroku apps:destroy --app $app --confirm $app; done &lt; delete_heroku_list 

Destroying ⬢ afternoon-stream-8326 (including all add-ons)... done
Destroying ⬢ agile-chamber-2464 (including all add-ons)... done
Destroying ⬢ agile-dawn-9072 (including all add-ons)... done
Destroying ⬢ agile-thicket-6113 (including all add-ons)... done
Destroying ⬢ ancient-bastion-6361 (including all add-ons)... done
Destroying ⬢ ancient-dusk-4608 (including all add-ons)... done

</code></pre>
<p>I could have burnt time doing a regex for the format of <code>&lt;word&gt;-&lt;word&gt;-&lt;four-digits&gt;</code> to find and delete all my apps without custom names, but that would have burnt time for something I&rsquo;m unlikely to need to do again, and it took a minute to get the file <code>delete_heroku_list</code> to have the names of all the crufty old apps I haven&rsquo;t used in years.</p>

<p>So my hereby dashboard is looking a lot cleaner.  I&rsquo;ve got my two main project pipelines in my &ldquo;favourites&rdquo;, and my Heroku navigation is a lot more manageable:</p>

<p><img src="https://www.dropbox.com/s/iaf134csxh7ij1g/Screenshot%202016-10-24%2010.09.56.png?dl=1" /></p>

<p>Although that doesn&rsquo;t immediately seem to have enabled automated PR deploys on LocalSupport - which still reports the 100 app limit exceeded.  I guess that will take time to flush through the system, or indeed I might need to try this new <code>purge_cache</code> technique that&rsquo;s mentioned above, but those are Yak&rsquo;s to be shaved.  I only just started on the data migration script for the premium plus upgrade feature, which needs to be finished, and there&rsquo;s a hell of a lot of other critical admin tasks to get to today.  At least this ties up some of the loose ends from last week, when I was worried the Yak shaving would continue indefinitely.  At least I&rsquo;ve got to a reasonably satisfying task switching point &hellip;</p>

<p>Related Videos:</p>

<ul>
<li><a href="https://youtu.be/_hAm_6T8r18">&ldquo;Martin Fowler&rdquo; scrum</a></li>
<li><a href="https://www.youtube.com/watch?v=feu722TBjo4">&ldquo;Kent Beck&rdquo; scrum</a></li>
</ul>

        <h2 class='author'>by Sam Joseph</h2>
      </div>  
      <div class="col-lg-2">
      </div>
    </div>  
  </div>  
</section>  
<footer>
    <div class="container">
        <section id="contact">
        <div class="row">
            <div class="col-md-4">
                <h3>AgileVentures</h3> 
                <p class="blurb text-muted">Our purpose is to develop better more affordable software solutions to enable non-profits to be more effective and more efficient. We also host a <a href="http://www.agileventures.org">learning community</a> around <a href="https://www.edx.org/xseries/agile-development-using-ruby-rails">free online courses</a> that enable developers to improve their team and software skills, and then to apply them on socially useful projects for non-profits. We are awaiting approval of our application to become a Charitable Incorporated Organisation (CIO) in the UK.</p>
            </div>
            <div class="col-md-4">
                <h3>What we do</h3>
                <div class="list">
                    <i class="fa fa-check fa-lg fa-text"><span class='font-override'>&nbsp;&nbsp;Websites</span></i>
                    <i class="fa fa-check fa-lg fa-text"><span class='font-override'>&nbsp;&nbsp;Apps</span></i>
                    <i class="fa fa-check fa-lg fa-text"><span class='font-override'>&nbsp;&nbsp;Process Automation</span></i>
                    <i class="fa fa-check fa-lg fa-text"><span class='font-override'>&nbsp;&nbsp;Software Projects</span></i>
                </div>
                <h4>More on our <a href="/blog">Blog</a></h4>
            </div>
            <div class="col-md-4">
                <h3>Contact Us</h3>
                <div class="contact-list">
                  <!-- <i class="fa fa-envelope fa-lg fa-text fa-fw"><span class='font-override'>&nbsp;&nbsp;</i> -->
                  <i class="fa fa-lg fa-text"><a class='mail' href='mailto:nonprofits@agileventures.org'>nonprofits@<wbr>agileventures.org</a></span></i>
                  <i class="fa fa-lg fa-text"><span class='font-override'>AgileVentures</span></i>
                  <!-- <i class="fa fa-map-marker fa-lg fa-text fa-fw"></i> -->
                  <i class="fa fa-lg fa-text"><span class='font-override'>The Lodge</span></i>
                  <i class="fa fa-lg fa-text"><span class='font-override'>64 Pinner Road</span></i>
                  <i class="fa fa-lg fa-text"><span class='font-override'>Harrow, HA1 4HZ</span></i>
                </div>
            </div>
        </div>
        </section>
        <div class="row">
            <div class="col-md-4">
                <ul class="list-inline quicklinks">
                    <li><a href="/privacy">Privacy Policy</a>
                    </li>
                    <li><a href="/terms">Terms of Use</a>
                    </li>
                </ul>
            </div>
            <div class="col-md-4">
                <span class="copyright">Copyright &copy; AgileVentures 2016</span>
            </div>
            <div class="col-md-4">
                <ul class="list-inline social-buttons">
                    <li><a href="https://twitter.com/AgileVentures"><i class="fa fa-twitter"></i></a>
                    </li>
                    <li><a href="https://www.facebook.com/agileventures"><i class="fa fa-facebook"></i></a>
                    </li>
                    <li><a href="https://www.linkedin.com/company/agileventures"><i class="fa fa-linkedin"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    </section>
</footer>

</body>
</html>
