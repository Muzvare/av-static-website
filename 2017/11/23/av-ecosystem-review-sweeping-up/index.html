<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>AV EcoSystem Review Sweeping Up</title>

    <!-- Bootstrap Core CSS -->
    <link href="/stylesheets/bootstrap.min.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Kaushan+Script" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link href="/stylesheets/site.css" rel="stylesheet" />
    <script src="/javascripts/all.js"></script>
    <link href="/images/favicon.ico" rel="icon" type="image/ico" />
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-91621093-1', 'auto');
      ga('send', 'pageview');

    </script>
</head>
<body class="x2017 x2017_11 x2017_11_23 x2017_11_23_av-ecosystem-review-sweeping-up x2017_11_23_av-ecosystem-review-sweeping-up_index">
    <link href="/stylesheets/highlighting.css" rel="stylesheet" />
<!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand page-scroll" href="/#page-top"><img width="175" src="/images/av-logo-inverse.png" /></a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li class="hidden">
                        <a href="/#page-top"></a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#why-us">Why us?</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#case-studies">Case Studies</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#about">About</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#subscribe">Subscribe</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#contact">Contact</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>
<section id="blog">
  <div class="container">
    <div class="row">
      <div class="col-lg-2">
      </div>
      <div class="col-lg-8 text-left">
        <h2 class='title'><a href="/2017/11/23/av-ecosystem-review-sweeping-up/">AV EcoSystem Review Sweeping Up</a></h2>
        <h5 class='date'>23 Nov 2017</h5>
    <p><img alt="broom" src="/images/broom.jpg" /></p>

<p>So confused about where to direct my efforts.  Maybe it doesn&rsquo;t matter?  Maybe I should be avoiding code like Avdi Grimm?  I&rsquo;m going to start by trying to clear up all the dependabot PRs.</p>

<p>I just used my administrator privileges to merge in upgrades to:</p>

<ul>
<li><a href="https://github.com/AgileVentures/WebsiteOne/pull/1898">Brakeman</a></li>
<li><a href="https://github.com/AgileVentures/WebsiteOne/pull/1899">Bullet</a></li>
<li><a href="https://github.com/AgileVentures/WebsiteOne/pull/1900">Bundler-Audit</a></li>
<li><a href="https://github.com/AgileVentures/WebsiteOne/pull/1901">Jasmine</a></li>
</ul>

<p>I&rsquo;m not really clear what the first three gems do.  Jasmine allows us to unit test our JavaScript.  Trying to update all these four in succession, leading to merges getting stuck through the GitHub UI.  I&rsquo;ve banged on them and I think they&rsquo;re all through now.  I pull those changes locally to update my gems locally.</p>

<p>One project manager experienced a 500 error last night that I assume was performance related, but we get nothing from systems like AirBrake that are supposed to tell us about these things.  I sort of feel like for a system of this size, what we need is four full time engineers to keep maintaining it all.  Maybe upgrading to Rails 5 is the key?  Maybe spending no time with my family? Or maybe re-doing the whole thing in WordPress like Avdi and Chuck &hellip;</p>

<p>Anyway, I&rsquo;m putting my head down and getting every dependabot automated gem upgrade PR through now.  I generally shy away from making multiple changes like this, but I&rsquo;m sick of the dependabot PRs drowning out the human PRs.  Of course even once I&rsquo;ve got the green ones through, there are all those that have come through and caught on the CI.  Now some are clearly failing because code needs to change, but others will just be from intermittent jasmine fails.  I think if we could rip out Mercury and replace it with a new editor, and that might get rid of half the intermittent fails, and maybe clear the way to get onto Rails 5.  However, I am unclear precisely what Rails 5 really buys us - maybe the ability to use websockets cleanly and so avoid a lot of stale data for our users in their browsers.  That said, realistically we could fix some of the current staleness issues with timers.</p>

<p>The difficultly with this dependabot system is that we&rsquo;ve got hundreds of gems and there&rsquo;s always going to be gem versions being bumped.  So even if I get through the current lot, there&rsquo;ll be more to come.  Perhaps the trick is to get new members merging these PRs?  Although that would mean needing to give them merge privileges &hellip; the ones where there&rsquo;s work required are generally tricky and not necessarily a good place for new members.  Perhaps just having them take the green PRs and running them locally to double check the CI?</p>

<p>So as I try to merge in more, I get conflicts in the Gemfile and Gemfile.lock, which I try to patch up.  I go to all the other dependabot failing PRs and update their branches.  Am I just doing a very long slow drawn out <code>bundle update</code> here?  Every single gem has to be tested with each other, in each combination.  The other issue is that every PR puts a load on our CI and our CI blocks deployment, so I&rsquo;ve probably set us up to be unable to deploy anything today.</p>

<p>I&rsquo;ve got a chunk of gems upgraded and I&rsquo;m running the tests locally to check, but I don&rsquo;t have so much faith in the tests. Hmmm.  What I do really want to do is get that new editor that Matt started working on and update the branch.  Matt&rsquo;s been MIA for the longest of the different contributors.  I&rsquo;m also seeing various messy messages in our build output.  When unclear about direction I guess maybe it&rsquo;s best just to focus on cleaning things up &hellip;</p>

<p>Frustratingly when I run RSpec in progress mode I can&rsquo;t see which tests the deprecation warnings are coming from.  The main ones I&rsquo;m getting are:</p>
<pre class="highlight plaintext"><code>DEPRECATION WARNING: You attempted to assign a value which is not explicitly `true` or `false` ("never") to a boolean column. Currently this value casts to `false`. This will change to match Ruby's semantics, and will cast to `true` in Rails 5. If you would like to maintain the current behavior, you should explicitly handle the values you would like cast to `false`. (called from block (3 levels) in &lt;top (required)&gt; at /Users/tansaku/Documents/GitHub/AgileVentures/WebsiteOne/spec/models/event_spec.rb:244)
</code></pre><pre class="highlight plaintext"><code>Unused parameters passed to Capybara::Queries::SelectorQuery : ["/auth/github"]
</code></pre><pre class="highlight plaintext"><code>WARNING: Using the `raise_error` matcher without providing a specific error or message risks false positives, since `raise_error` will match when Ruby raises a `NoMethodError`, `NameError` or `ArgumentError`, potentially allowing the expectation to pass without even executing the method you are intending to call. Actual error raised was #&lt;ActiveRecord::StatementInvalid: PG::NotNullViolation: ERROR:  null value in column "user_id" violat...
: UPDATE "authentications" SET "user_id" = $1, "updated_at" = $2 WHERE "authentications"."id" = $3&gt;. Instead consider providing a specific error class or message. This message can be suppressed by setting: `RSpec::Expectations.configuration.on_potential_false_positives = :nothing`. Called from /Users/tansaku/Documents/GitHub/AgileVentures/WebsiteOne/spec/models/authentication_spec.rb:12:in `block (2 levels) in &lt;top (required)&gt;'.
</code></pre>
<p>Ah, actually some of the error messages are telling me where the problems are arising &hellip;  of course kicking off a cucumber test run locally blocks me from doing any coding work on the project for 10 minutes+ since we still have these stupidly long running tests in places &hellip; I guess I will do my station keeping (social media updates) until they finish&hellip;</p>

<p>Only one failure in the cukes:</p>
<pre class="highlight plaintext"><code>Encountered Error in get: 404 Resource Not Found: {"code":"route_not_found","kind":"error","error":"The path you requested has no valid endpoint."}
</code></pre>
<p>Having merged the conflict in the Medium-editor branch, I&rsquo;m not even getting the chance to update the branch, so let&rsquo;s at least try to clear up some cruft in the RSpec output.</p>

<p>The first item seems a little tricky, although it looks like we do need to fix it before we move to Rails 5, and it seems like I can fix it at the spec level as simply as adding this to the event model:</p>
<pre class="highlight ruby"><code>  <span class="k">def</span> <span class="nf">repeat_ends</span><span class="o">=</span><span class="p">(</span><span class="n">repeat_ends</span><span class="p">)</span>
    <span class="k">super</span> <span class="n">repeat_ends</span> <span class="o">==</span> <span class="s1">'on'</span>
  <span class="k">end</span>
</code></pre>
<p>and fixing the factories to ensure they used &lsquo;on&rsquo; and &#39;never&rsquo; rather than booleans.  The issue here is that the underlying column type for <code>repeat_ends</code> is boolean, but the model is working with it as a string.  Of course the real question is how the acceptance tests perform now.  I get a sequence of errors - if I&rsquo;m lucky they are all about factories (being used in the Cukes).  They are not - they are actually using the full form, and we have javascript running in the browser to set things up - and it&rsquo;s not showing certain fields.  There&rsquo;s some complexity to fix all this, and even if I have the tests passing, I won&rsquo;t be sure I haven&rsquo;t introduced a bug into our events management.</p>

<p>Fixing the <code>raise_error</code> issue is a trivial change to the spec:</p>
<pre class="highlight ruby"><code>  <span class="n">it</span> <span class="s1">'must have an associated user'</span> <span class="k">do</span>
    <span class="c1"># Bryan: validations done at database level to avoid complications, but will raise exceptions</span>
    <span class="vi">@auth</span><span class="p">.</span><span class="nf">user_id</span> <span class="o">=</span> <span class="kp">nil</span>
    <span class="n">expect</span><span class="p">{</span> <span class="vi">@auth</span><span class="p">.</span><span class="nf">save</span> <span class="p">}.</span><span class="nf">to</span> <span class="n">raise_error</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">StatementInvalid</span> <span class="c1"># &lt;-- add this error type here</span>
  <span class="k">end</span>
</code></pre>
<p>And I decide to delete all the view specs, as those warnings are telling me that many of them aren&rsquo;t testing what they should be.  In the ideal world I&rsquo;d work through every single one and work out where they&rsquo;re corresponding to in terms of missing acceptance test functionality, but part of the overall problem here is not having the resources to maintain so much code.  I think I need to hack and slash a bit to make some kind of progress.  Maybe I can spend tomorrow debugging the events <code>repeat_ends</code> issue and I&rsquo;ll have the RSpec output cleaned out.  Not sure that&rsquo;s where my attention is most needed, but when I really can&rsquo;t decide what high level issue to focus on, I guess it&rsquo;s not a bad thing to do some sweeping up &hellip;</p>

        <h2 class='author'>by Sam Joseph</h2>
      </div>  
      <div class="col-lg-2">
      </div>
    </div>  
  </div>  
</section>  
<footer>
    <div class="container">
        <section id="contact">
        <div class="row">
            <div class="col-md-4">
                <h3>AgileVentures</h3>
                <p class="blurb text-muted">Our purpose is to develop better more affordable software solutions to enable non-profits to be more effective and more efficient. We also host a <a href="http://www.agileventures.org">learning community</a> around <a href="https://www.edx.org/xseries/agile-development-using-ruby-rails">free online courses</a> that enable developers to improve their team and software skills, and then to apply them on socially useful projects for non-profits. We are a Charitable Incorporated Organisation (CIO) in the UK. Ref #1170963</p>
            </div>
            <div class="col-md-4">
                <h3>What we do</h3>
                <div class="list">
                    <i class="fa fa-check fa-lg fa-text"><span class='font-override'>&nbsp;&nbsp;Websites</span></i>
                    <i class="fa fa-check fa-lg fa-text"><span class='font-override'>&nbsp;&nbsp;Apps</span></i>
                    <i class="fa fa-check fa-lg fa-text"><span class='font-override'>&nbsp;&nbsp;Process Automation</span></i>
                    <i class="fa fa-check fa-lg fa-text"><span class='font-override'>&nbsp;&nbsp;Software Projects</span></i>
                </div>
                <h4>More on our <a href="/blog">Blog</a></h4>
            </div>
            <div class="col-md-4">
                <h3>Contact Us</h3>
                <div class="contact-list">
                  <!-- <i class="fa fa-envelope fa-lg fa-text fa-fw"><span class='font-override'>&nbsp;&nbsp;</i> -->
                  <i class="fa fa-lg fa-text"><a class='mail' href='mailto:nonprofits@agileventures.org'>nonprofits@<wbr>agileventures.org</a></span></i>
                  <i class="fa fa-lg fa-text"><span class='font-override'>AgileVentures</span></i>
                  <!-- <i class="fa fa-map-marker fa-lg fa-text fa-fw"></i> -->
                  <i class="fa fa-lg fa-text"><span class='font-override'>The Lodge</span></i>
                  <i class="fa fa-lg fa-text"><span class='font-override'>64 Pinner Road</span></i>
                  <i class="fa fa-lg fa-text"><span class='font-override'>Harrow, HA1 4HZ</span></i>
                </div>
            </div>
        </div>
        </section>
        <div class="row">
            <div class="col-md-4">
                <ul class="list-inline quicklinks">
                    <li><a href="/privacy">Privacy Policy</a>
                    </li>
                    <li><a href="/terms">Terms of Use</a>
                    </li>
                </ul>
            </div>
            <div class="col-md-4">
                <span class="copyright">Copyright &copy; AgileVentures 2017</span>
            </div>
            <div class="col-md-4">
                <ul class="list-inline social-buttons">
                    <li><a href="https://twitter.com/AgileVentures"><i class="fa fa-twitter"></i></a>
                    </li>
                    <li><a href="https://www.facebook.com/agileventures"><i class="fa fa-facebook"></i></a>
                    </li>
                    <li><a href="https://www.linkedin.com/company/agileventures"><i class="fa fa-linkedin"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    </section>
</footer>


</body>
</html>
