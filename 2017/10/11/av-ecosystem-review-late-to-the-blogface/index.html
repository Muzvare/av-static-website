<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>AV EcoSystem Review Late to the Blogface</title>

    <!-- Bootstrap Core CSS -->
    <link href="/stylesheets/bootstrap.min.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Kaushan+Script" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link href="/stylesheets/site.css" rel="stylesheet" />
    <script src="/javascripts/all.js"></script>
    <link href="/images/favicon.ico" rel="icon" type="image/ico" />
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-91621093-1', 'auto');
      ga('send', 'pageview');

    </script>
</head>
<body class="x2017 x2017_10 x2017_10_11 x2017_10_11_av-ecosystem-review-late-to-the-blogface x2017_10_11_av-ecosystem-review-late-to-the-blogface_index">
    <link href="/stylesheets/highlighting.css" rel="stylesheet" />
<!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand page-scroll" href="/#page-top"><img width="175" src="/images/av-logo-inverse.png" /></a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li class="hidden">
                        <a href="/#page-top"></a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#why-us">Why us?</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#case-studies">Case Studies</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#about">About</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#subscribe">Subscribe</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#contact">Contact</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>
<section id="blog">
  <div class="container">
    <div class="row">
      <div class="col-lg-2">
      </div>
      <div class="col-lg-8 text-left">
        <h2 class='title'><a href="/2017/10/11/av-ecosystem-review-late-to-the-blogface/">AV EcoSystem Review Late to the Blogface</a></h2>
        <h5 class='date'>11 Oct 2017</h5>
    <p><img alt="late" src="/images/late.jpg" /></p>

<p>Well, I am very late to the blogface this morning after doing a 7.5km jog and then experimenting with making an eggs benedict for the first time in my life.  To compound it I had two podcasts to post to Twitter and Slack, and in an exhausted overfed state I had little resistance to reviewing all my Slack and email messages.  I stopped short of looking at all the Twitter notifications.  There&rsquo;s definitely some kind of micro-message addiction going on here.   I can&rsquo;t remember what it was I was excited to work on.  Maybe it was clipping the time/dates off the Slack messages.  I&rsquo;m pretty pleased with how far we&rsquo;ve come in dropping the old Agile bot (leading to $21 a month savings), and producing a new Ruby agile-bot as part of our Rails monolith that is now messaging like this:</p>

<p><img src="https://dl.dropbox.com/s/wo71jxlx2knvr6m/Screenshot%202017-10-11%2010.31.38.png?dl=1" /></p>

<p>I&rsquo;ve added what I hope is a welcoming tone to both the reminder and the event title.  I suspect that the time/date stamp is being added to the event instance title, so that the date is available in views like &ldquo;Previous scrums&rdquo;:</p>

<p><img src="https://dl.dropbox.com/s/998m7v4fzmc747h/Screenshot%202017-10-11%2010.33.29.png?dl=1" /></p>

<p>but it makes no sense in the context of the Slack chat.  We did have one member a bit confused by the new syntax, since the direct links to the hangouts etc. were no longer visible.  Not ideal - perhaps we need a click to join message?  What I&rsquo;d really like to work out is where in the code flow the date/timestamp is getting added to the event instance title &hellip; a little search and I think it&rsquo;s being set in the form that starts the event instance in the event show page, which uses a topic helper in the EventHelper:</p>
<pre class="highlight ruby"><code><span class="k">def</span> <span class="nf">topic</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">event_schedule</span><span class="p">)</span>
  <span class="s2">"</span><span class="si">#{</span><span class="n">event</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">#{</span><span class="n">current_occurrence_time</span><span class="p">(</span><span class="n">event_schedule</span><span class="p">.</span><span class="nf">first</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</code></pre>
<p>Now rather than changing that - perhaps I can set it up so that the post to Slack uses the event name and not the event instance title.  That would mean adding more mocks to the slack Service spec - and also highlights the need for acceptance tests that exercise this pathway (and make the high level motivations clear).  If I&rsquo;d got to the computer at 9am, maybe - right now I just want to get a quick fix and move on.  Particularly I want to move on to even higher level review for Thursday and Friday. So can I slip this out, or will I get distracted by replacing the ActiveRecord models in the SlackService spec with mock_models? &hellip; which I do, but then I think, actually perhaps displaying the UTC time and day is kind of useful in our Slack, since people are in different timezones and often referring to UTC can be helpful as a kind of baseline.  Hmmm, maybe I should just go for a quick refactoring ticket to scratch my code itch?</p>

<p>I&rsquo;ve also got the dependabot upgrades to work through &hellip; I&rsquo;ve merged in the bump to rails 4.2.10.  I&rsquo;m wondering if I should just splurge in all the rest that are passing &hellip; well, anyway, I got a chunk of the SlackService spec working with mock_models:</p>
<pre class="highlight ruby"><code>    <span class="n">context</span><span class="p">(</span><span class="s1">'PairProgramming'</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">let</span><span class="p">(</span><span class="ss">:websiteone_project</span><span class="p">)</span> <span class="p">{</span> <span class="n">mock_model</span> <span class="no">Project</span><span class="p">,</span> <span class="ss">slug: </span><span class="s1">'websiteone'</span> <span class="p">}</span>

      <span class="n">let</span><span class="p">(</span><span class="ss">:websiteone_hangout</span><span class="p">)</span> <span class="p">{</span> <span class="n">mock_model</span> <span class="no">EventInstance</span><span class="p">,</span> <span class="ss">title: </span><span class="s1">'MockEvent'</span><span class="p">,</span> <span class="ss">category: </span><span class="s2">"PairProgramming"</span><span class="p">,</span> <span class="ss">hangout_url: </span><span class="s2">"mock_url"</span><span class="p">,</span> <span class="ss">user: </span><span class="n">user</span><span class="p">,</span> <span class="ss">project: </span><span class="n">websiteone_project</span> <span class="p">}</span>

      <span class="n">it</span> <span class="s1">'sends the correct slack message to the correct channels when associated with a project'</span> <span class="k">do</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">slack_client</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:chat_postMessage</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="n">general_channel_post_args</span><span class="p">)</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">slack_client</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:chat_postMessage</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="n">websiteone_project_channel_post_args</span><span class="p">)</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">slack_client</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:chat_postMessage</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="n">pairing_notifications_channel_post_args</span><span class="p">)</span>

        <span class="n">slack_service</span><span class="p">.</span><span class="nf">post_hangout_notification</span><span class="p">(</span><span class="n">websiteone_hangout</span><span class="p">,</span> <span class="n">slack_client</span><span class="p">,</span> <span class="n">gitter_client</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="n">let</span><span class="p">(</span><span class="ss">:no_project_hangout</span><span class="p">)</span> <span class="p">{</span> <span class="n">mock_model</span> <span class="no">EventInstance</span><span class="p">,</span> <span class="ss">title: </span><span class="s1">'MockEvent'</span><span class="p">,</span> <span class="ss">category: </span><span class="s2">"PairProgramming"</span><span class="p">,</span> <span class="ss">hangout_url: </span><span class="s2">"mock_url"</span><span class="p">,</span> <span class="ss">user: </span><span class="n">user</span><span class="p">,</span> <span class="ss">project: </span><span class="kp">nil</span> <span class="p">}</span>

      <span class="n">it</span> <span class="s1">'does not fail when event has no associated project'</span> <span class="k">do</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">slack_client</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:chat_postMessage</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="n">general_channel_post_args</span><span class="p">)</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">slack_client</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:chat_postMessage</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="n">pairing_notifications_channel_post_args</span><span class="p">)</span>

        <span class="n">slack_service</span><span class="p">.</span><span class="nf">post_hangout_notification</span><span class="p">(</span><span class="n">no_project_hangout</span><span class="p">,</span> <span class="n">slack_client</span><span class="p">,</span> <span class="n">gitter_client</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="n">let</span><span class="p">(</span><span class="ss">:cs169_project</span><span class="p">)</span> <span class="p">{</span> <span class="n">mock_model</span> <span class="no">Project</span><span class="p">,</span> <span class="ss">slug: </span><span class="s1">'cs169'</span> <span class="p">}</span>
      <span class="n">let</span><span class="p">(</span><span class="ss">:cs169_hangout</span><span class="p">)</span> <span class="p">{</span> <span class="n">mock_model</span> <span class="no">EventInstance</span><span class="p">,</span> <span class="ss">title: </span><span class="s1">'MockEvent'</span><span class="p">,</span> <span class="ss">category: </span><span class="s2">"PairProgramming"</span><span class="p">,</span> <span class="ss">hangout_url: </span><span class="s2">"mock_url"</span><span class="p">,</span> <span class="ss">user: </span><span class="n">user</span><span class="p">,</span> <span class="ss">project: </span><span class="n">cs169_project</span> <span class="p">}</span>

      <span class="n">it</span> <span class="s1">'should ping gitter and slack (but not general) when the project is cs169'</span> <span class="k">do</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">gitter_client</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:messages</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="s1">'56b8bdffe610378809c070cc'</span><span class="p">,</span> <span class="ss">limit: </span><span class="mi">50</span><span class="p">).</span><span class="nf">and_return</span><span class="p">([])</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">gitter_client</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:send_message</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="s1">'[MockEvent with random](mock_url) is starting NOW!'</span><span class="p">,</span> <span class="s2">"56b8bdffe610378809c070cc"</span><span class="p">)</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">slack_client</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:chat_postMessage</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="n">cs169_project_channel_post_args</span><span class="p">)</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">slack_client</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:chat_postMessage</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="n">pairing_notifications_channel_post_args</span><span class="p">)</span>

        <span class="n">slack_service</span><span class="p">.</span><span class="nf">post_hangout_notification</span><span class="p">(</span><span class="n">cs169_hangout</span><span class="p">,</span> <span class="n">slack_client</span><span class="p">,</span> <span class="n">gitter_client</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="n">let</span><span class="p">(</span><span class="ss">:missing_url_hangout</span><span class="p">)</span> <span class="p">{</span> <span class="n">mock_model</span> <span class="no">EventInstance</span><span class="p">,</span> <span class="ss">title: </span><span class="s1">'MockEvent'</span><span class="p">,</span> <span class="ss">category: </span><span class="s2">"PairProgramming"</span><span class="p">,</span> <span class="ss">hangout_url: </span><span class="s2">"  "</span><span class="p">,</span> <span class="ss">user: </span><span class="n">user</span> <span class="p">}</span>

      <span class="n">it</span> <span class="s1">'does not post notification if hangout url is blank'</span> <span class="k">do</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">slack_client</span><span class="p">).</span><span class="nf">not_to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:chat_postMessage</span><span class="p">)</span>

        <span class="n">slack_service</span><span class="p">.</span><span class="nf">post_hangout_notification</span><span class="p">(</span><span class="n">missing_url_hangout</span><span class="p">,</span> <span class="n">slack_client</span><span class="p">,</span> <span class="n">gitter_client</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
</code></pre>
<p>which is kind of an improvement - slightly faster than creating real ActiveRecord models.  Slightly less realistic, so pushing this away from integration and towards unit testing.  Re-arranging deck chairs?  I&rsquo;d love to boil this code down to make it clean and transparent, but perhaps that&rsquo;s something for a pairing session where my pair partner can keep me on the straight and narrow.  Time to jump back up a few levels, starting tomorrow - let&rsquo;s check in on the changes to the &ldquo;Getting Started&rdquo; page and the flow of how people arrive there.</p>

        <h2 class='author'>by Sam Joseph</h2>
      </div>  
      <div class="col-lg-2">
      </div>
    </div>  
  </div>  
</section>  
<footer>
    <div class="container">
        <section id="contact">
        <div class="row">
            <div class="col-md-4">
                <h3>AgileVentures</h3>
                <p class="blurb text-muted">Our purpose is to develop better more affordable software solutions to enable non-profits to be more effective and more efficient. We also host a <a href="http://www.agileventures.org">learning community</a> around <a href="https://www.edx.org/xseries/agile-development-using-ruby-rails">free online courses</a> that enable developers to improve their team and software skills, and then to apply them on socially useful projects for non-profits. We are a Charitable Incorporated Organisation (CIO) in the UK. Ref #1170963</p>
            </div>
            <div class="col-md-4">
                <h3>What we do</h3>
                <div class="list">
                    <i class="fa fa-check fa-lg fa-text"><span class='font-override'>&nbsp;&nbsp;Websites</span></i>
                    <i class="fa fa-check fa-lg fa-text"><span class='font-override'>&nbsp;&nbsp;Apps</span></i>
                    <i class="fa fa-check fa-lg fa-text"><span class='font-override'>&nbsp;&nbsp;Process Automation</span></i>
                    <i class="fa fa-check fa-lg fa-text"><span class='font-override'>&nbsp;&nbsp;Software Projects</span></i>
                </div>
                <h4>More on our <a href="/blog">Blog</a></h4>
            </div>
            <div class="col-md-4">
                <h3>Contact Us</h3>
                <div class="contact-list">
                  <!-- <i class="fa fa-envelope fa-lg fa-text fa-fw"><span class='font-override'>&nbsp;&nbsp;</i> -->
                  <i class="fa fa-lg fa-text"><a class='mail' href='mailto:nonprofits@agileventures.org'>nonprofits@<wbr>agileventures.org</a></span></i>
                  <i class="fa fa-lg fa-text"><span class='font-override'>AgileVentures</span></i>
                  <!-- <i class="fa fa-map-marker fa-lg fa-text fa-fw"></i> -->
                  <i class="fa fa-lg fa-text"><span class='font-override'>The Lodge</span></i>
                  <i class="fa fa-lg fa-text"><span class='font-override'>64 Pinner Road</span></i>
                  <i class="fa fa-lg fa-text"><span class='font-override'>Harrow, HA1 4HZ</span></i>
                </div>
            </div>
        </div>
        </section>
        <div class="row">
            <div class="col-md-4">
                <ul class="list-inline quicklinks">
                    <li><a href="/privacy">Privacy Policy</a>
                    </li>
                    <li><a href="/terms">Terms of Use</a>
                    </li>
                </ul>
            </div>
            <div class="col-md-4">
                <span class="copyright">Copyright &copy; AgileVentures 2017</span>
            </div>
            <div class="col-md-4">
                <ul class="list-inline social-buttons">
                    <li><a href="https://twitter.com/AgileVentures"><i class="fa fa-twitter"></i></a>
                    </li>
                    <li><a href="https://www.facebook.com/agileventures"><i class="fa fa-facebook"></i></a>
                    </li>
                    <li><a href="https://www.linkedin.com/company/agileventures"><i class="fa fa-linkedin"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    </section>
</footer>


</body>
</html>
