<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>AV EcoSystem Pride Comes Before A Fall</title>

    <!-- Bootstrap Core CSS -->
    <link href="/stylesheets/bootstrap.min.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Kaushan+Script" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link href="/stylesheets/site.css" rel="stylesheet" />
    <script src="/javascripts/all.js"></script>
    <link href="/images/favicon.ico" rel="icon" type="image/ico" />
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-91621093-1', 'auto');
      ga('send', 'pageview');

    </script>
</head>
<body class="x2017 x2017_10 x2017_10_05 x2017_10_05_av-ecosystem-review-pride-comes-before-a-fall x2017_10_05_av-ecosystem-review-pride-comes-before-a-fall_index">
    <link href="/stylesheets/highlighting.css" rel="stylesheet" />
<!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand page-scroll" href="/#page-top"><img width="175" src="/images/av-logo-inverse.png" /></a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li class="hidden">
                        <a href="/#page-top"></a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#why-us">Why us?</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#case-studies">Case Studies</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#about">About</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#subscribe">Subscribe</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="/#contact">Contact</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>
<section id="blog">
  <div class="container">
    <div class="row">
      <div class="col-lg-2">
      </div>
      <div class="col-lg-8 text-left">
        <h2 class='title'><a href="/2017/10/05/av-ecosystem-review-pride-comes-before-a-fall/">AV EcoSystem Pride Comes Before A Fall</a></h2>
        <h5 class='date'> 5 Oct 2017</h5>
    <p><img alt="pride" src="/images/pride.jpg" /></p>

<p>So they say that pride comes before a fall.  Just after being so pleased with myself for fixing the strange double leakage issue introduced by the new Slack gem (pass in Rails.logger), I got notices that I&rsquo;d posted some secret tokens to GitHub.  In committing the latest vcr cassettes I had inadvertently included the Slack and Gitter api tokens.  It&rsquo;s a relatively easy fix with the following code in the VCR config:</p>
<pre class="highlight ruby"><code>  <span class="n">c</span><span class="p">.</span><span class="nf">filter_sensitive_data</span><span class="p">(</span><span class="s1">'&lt;SLACK_AUTH_TOKEN&gt;'</span><span class="p">)</span> <span class="p">{</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'SLACK_AUTH_TOKEN'</span><span class="p">]</span> <span class="p">}</span>
  <span class="n">c</span><span class="p">.</span><span class="nf">filter_sensitive_data</span><span class="p">(</span><span class="s1">'&lt;GITTER_API_TOKEN&gt;'</span><span class="p">)</span> <span class="p">{</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'GITTER_API_TOKEN'</span><span class="p">]</span> <span class="p">}</span>
</code></pre>
<p>but I&rsquo;ll have to regenerate the existing tokens &hellip; anyway, we&rsquo;re running out of week to get this feature fixed up.  The key issues outstanding (now that we have all the existing tests passing) are:</p>

<p>1) managing the different Slack and Gitter room ids for staging and production
2) deciding whether to add explicit cukes that check that the Slack and Gitter APIs are hit
3) filling out all the pending unit tests</p>

<p>I think I&rsquo;ve got to start with item 1.  On agile-bot, Michael and I set up a separate ENV var (<code>LIVE_ENV</code>) to specify whether the &ldquo;production&rdquo; Slack should be hit &hellip; I had half a mind to check which URL the instance was running against, but probably easier to re-use the <code>LIVE_ENV</code> concept.  I take a stab with the ugly:</p>
<pre class="highlight ruby"><code>  <span class="k">if</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'LIVE_ENV'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'production'</span>
    <span class="no">CHANNELS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"asyncvoter"</span><span class="p">:</span> <span class="s2">"C2HGJF54G"</span><span class="p">,</span>
        <span class="s2">"autograder"</span><span class="p">:</span> <span class="s2">"C0UFNHRAB"</span><span class="p">,</span>
        <span class="s2">"betasaasers"</span><span class="p">:</span> <span class="s2">"C02AHEA5P"</span><span class="p">,</span>
        <span class="s2">"binghamton-university-bike-share"</span><span class="p">:</span> <span class="s2">"C033Z02P9"</span><span class="p">,</span>
        <span class="s2">"codealia"</span><span class="p">:</span> <span class="s2">"C0297TUQC"</span><span class="p">,</span>
        <span class="p">.</span><span class="nf">.</span><span class="o">.</span>
        <span class="s2">"pairing_notifications"</span><span class="p">:</span> <span class="s2">"C02BNVCM1"</span><span class="p">,</span>
        <span class="s2">"standup_notifications"</span><span class="p">:</span> <span class="s2">"C02B4QH1C"</span>
    <span class="p">}</span>
    <span class="no">GITTER_ROOMS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"saasbook/MOOC"</span><span class="p">:</span> <span class="s2">"544100afdb8155e6700cc5e4"</span><span class="p">,</span>
        <span class="s2">"saasbook/AV102"</span><span class="p">:</span> <span class="s2">"55e42db80fc9f982beaf2725"</span><span class="p">,</span>
        <span class="s2">"AgileVentures/agile-bot"</span><span class="p">:</span> <span class="s2">"56b8bdffe610378809c070cc"</span>
    <span class="p">}</span>
  <span class="k">else</span>
    <span class="no">CHANNELS</span> <span class="o">=</span>    <span class="p">{</span>
        <span class="s2">"cs169"</span><span class="p">:</span> <span class="s2">"C29J4CYA2"</span><span class="p">,</span>
        <span class="s2">"websiteone"</span><span class="p">:</span> <span class="s2">"C29J4QQ9W"</span><span class="p">,</span>
        <span class="s2">"general"</span><span class="p">:</span> <span class="s2">"C0TLAE1MH"</span><span class="p">,</span>
        <span class="s2">"pairing_notifications"</span><span class="p">:</span> <span class="s2">"C29J3DPGW"</span><span class="p">,</span>
        <span class="s2">"standup_notifications"</span><span class="p">:</span> <span class="s2">"C29JE6HGR"</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="no">GITTER_ROOMS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"saasbook/MOOC"</span><span class="p">:</span> <span class="s2">"56b8bdffe610378809c070cc"</span><span class="p">,</span>
        <span class="s2">"saasbook/AV102"</span><span class="p">:</span> <span class="s2">"56b8bdffe610378809c070cc"</span><span class="p">,</span>
        <span class="s2">"AgileVentures/agile-bot"</span><span class="p">:</span> <span class="s2">"56b8bdffe610378809c070cc"</span>
    <span class="p">}</span>
  <span class="k">end</span>
</code></pre>
<p>Which maybe should be loaded from a file - I have a funny reticence to load things from files.  I&rsquo;ve never been so comfortable with grabbing stuff from files - a legacy from Java where it was such a pain?  In Ruby it&rsquo;s pretty damn trivial.  I guess when I have stuff formatted in one way, stepping through and reformatting for yaml, or what have you, causes my motivation to collapse.  What we really want in the end is to be looking all these up from the Slack API, so I&rsquo;m going to leave that for a refactoring, get the rest of the unit tests to pass and try to get this onto staging to see if my claims that we can replace the agile-bot are close to true.</p>

<p>So I stab about a bit and with a fair amount of replication of tests (and some refactoring), I get the output of the RSpec test to this:</p>
<pre class="highlight plaintext"><code>SlackService
  .post_hangout_notification
    PairProgramming
      sends the correct slack message to the correct channels
      does not post notification if hangout url is blank
      does not fail when event has no associated project
      should ping gitter and slack (but not general) when the project is cs169
    Scrums
      does not post notification if hangout url is blank for pairing
      should ping slack when the project is cs169
      does not fail when event has no associated project
      sends the correct slack message to the correct channels
  .post_yt_link
    Scrums
      does not post youtube video link if yt_video_id is blank
      sends the correct slack message to the correct channels
    PairProgramming
      does not ping slack when the project is cs169
      does not post youtube video link if yt_video_id is blank
      sends the correct slack message to the correct channels
</code></pre>
<p>Which I think is a lot better coverage than we have had.  What I&rsquo;d really like is a local report of coverage for this file for these tests.  There&rsquo;s also a lot of replication in the SlackService file itself, but I think I will leave a major refactor here until I&rsquo;ve seen all our existing functionality replicated.  First, let&rsquo;s get this PR merged and onto staging, where I can test all the settings against hitting a backup Slack instance, and then ease this into production &hellip;</p>

        <h2 class='author'>by Sam Joseph</h2>
      </div>  
      <div class="col-lg-2">
      </div>
    </div>  
  </div>  
</section>  
<footer>
    <div class="container">
        <section id="contact">
        <div class="row">
            <div class="col-md-4">
                <h3>AgileVentures</h3>
                <p class="blurb text-muted">Our purpose is to develop better more affordable software solutions to enable non-profits to be more effective and more efficient. We also host a <a href="http://www.agileventures.org">learning community</a> around <a href="https://www.edx.org/xseries/agile-development-using-ruby-rails">free online courses</a> that enable developers to improve their team and software skills, and then to apply them on socially useful projects for non-profits. We are a Charitable Incorporated Organisation (CIO) in the UK. Ref #1170963</p>
            </div>
            <div class="col-md-4">
                <h3>What we do</h3>
                <div class="list">
                    <i class="fa fa-check fa-lg fa-text"><span class='font-override'>&nbsp;&nbsp;Websites</span></i>
                    <i class="fa fa-check fa-lg fa-text"><span class='font-override'>&nbsp;&nbsp;Apps</span></i>
                    <i class="fa fa-check fa-lg fa-text"><span class='font-override'>&nbsp;&nbsp;Process Automation</span></i>
                    <i class="fa fa-check fa-lg fa-text"><span class='font-override'>&nbsp;&nbsp;Software Projects</span></i>
                </div>
                <h4>More on our <a href="/blog">Blog</a></h4>
            </div>
            <div class="col-md-4">
                <h3>Contact Us</h3>
                <div class="contact-list">
                  <!-- <i class="fa fa-envelope fa-lg fa-text fa-fw"><span class='font-override'>&nbsp;&nbsp;</i> -->
                  <i class="fa fa-lg fa-text"><a class='mail' href='mailto:nonprofits@agileventures.org'>nonprofits@<wbr>agileventures.org</a></span></i>
                  <i class="fa fa-lg fa-text"><span class='font-override'>AgileVentures</span></i>
                  <!-- <i class="fa fa-map-marker fa-lg fa-text fa-fw"></i> -->
                  <i class="fa fa-lg fa-text"><span class='font-override'>The Lodge</span></i>
                  <i class="fa fa-lg fa-text"><span class='font-override'>64 Pinner Road</span></i>
                  <i class="fa fa-lg fa-text"><span class='font-override'>Harrow, HA1 4HZ</span></i>
                </div>
            </div>
        </div>
        </section>
        <div class="row">
            <div class="col-md-4">
                <ul class="list-inline quicklinks">
                    <li><a href="/privacy">Privacy Policy</a>
                    </li>
                    <li><a href="/terms">Terms of Use</a>
                    </li>
                </ul>
            </div>
            <div class="col-md-4">
                <span class="copyright">Copyright &copy; AgileVentures 2017</span>
            </div>
            <div class="col-md-4">
                <ul class="list-inline social-buttons">
                    <li><a href="https://twitter.com/AgileVentures"><i class="fa fa-twitter"></i></a>
                    </li>
                    <li><a href="https://www.facebook.com/agileventures"><i class="fa fa-facebook"></i></a>
                    </li>
                    <li><a href="https://www.linkedin.com/company/agileventures"><i class="fa fa-linkedin"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    </section>
</footer>


</body>
</html>
