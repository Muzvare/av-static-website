<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Blog Name</title>
  <subtitle>Blog subtitle</subtitle>
  <id>http://blog.url.com/</id>
  <link href="http://blog.url.com/"/>
  <link href="http://blog.url.com/feed.xml" rel="self"/>
  <updated>2017-11-03T00:00:00+00:00</updated>
  <author>
    <name>Blog Author</name>
  </author>
  <entry>
    <title>AV EcoSystem Review Tying Up the Week</title>
    <link rel="alternate" href="http://blog.url.com/2017/11/03/av-ecosystem-review-tying-up-the-week/"/>
    <id>http://blog.url.com/2017/11/03/av-ecosystem-review-tying-up-the-week/</id>
    <published>2017-11-03T00:00:00+00:00</published>
    <updated>2018-01-17T20:25:16+00:00</updated>
    <author>
      <name>Article Author</name>
    </author>
    <content type="html">&lt;p&gt;&lt;img alt="tying up" src="/images/tying_up.jpg" /&gt;&lt;/p&gt;

&lt;p&gt;So I didn&amp;rsquo;t manage to get the &lt;code&gt;updated_at&lt;/code&gt; -&amp;gt; &lt;code&gt;created_at&lt;/code&gt; fix deployed in advance of the Kent Beck scrum yesterday, so I still can&amp;rsquo;t say for certain that I have fixed the bug where the old YouTube link gets posted on daily events.  I believe everything is deployed now, so we&amp;rsquo;ll have a proper test of that today.  Gosh I really hope there isn&amp;rsquo;t some other concealed bug.  I&amp;rsquo;d hoped to bash out a fix and quickly move on to other things, but it seems to have take all week.&lt;/p&gt;

&lt;p&gt;That said I have got a &amp;ldquo;Premium Mob&amp;rdquo; ad added to the AdWords and although it&amp;rsquo;s not live yet, I showed it in the marketing meeting along with a slew of other ideas that seemed to go down quite well.  Lara&amp;rsquo;s going to configure the keywords and ad groups and get that out, so I can focus on other things.  Thanks Lara!  I haven&amp;rsquo;t encountered any 500 errors trying to load events pages this week, but I also don&amp;rsquo;t see any big improvement in the aggregate stats, weird.  Still that brings me back to the set of things I thought of from reviewing the waffle board earlier in the week:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;tawk.to site integrated chat system&lt;/li&gt;
&lt;li&gt;replacing the mercury editor so we can move to Rails 5&lt;/li&gt;
&lt;li&gt;supporting private events&lt;/li&gt;
&lt;li&gt;looking at long running cukes&lt;/li&gt;
&lt;li&gt;hosting our own jitsi&lt;/li&gt;
&lt;li&gt;making main page counter dynamic&lt;/li&gt;
&lt;li&gt;notifying project creator when people join project&lt;/li&gt;
&lt;li&gt;having getting started page tick off progress&lt;/li&gt;
&lt;li&gt;better modelling of premium users&lt;/li&gt;
&lt;li&gt;allowing premium users to change payment methods&lt;/li&gt;
&lt;li&gt;start hangout button not working &amp;hellip;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The &amp;ldquo;Start hangout&amp;rdquo; button feels particularly problematic as students from the MOOC will try to use it and I think it will just not work.  Perhaps a quick disabling of it is in order &amp;hellip; I&amp;rsquo;m also full of thoughts from the LocalSupport meeting yesterday and wonder if AV ecosystem review blogs should extend to cover the operational flow of projects like LocalSupport?&lt;/p&gt;

&lt;p&gt;I think I&amp;rsquo;ll get a quick something on it started &amp;hellip; checking the #websiteone channel I notice some voting has gone on in async votes I started during the week - that&amp;rsquo;s cool.  I update the tickets with the votes (would be great if that happened automatically), and add some labels for &amp;ldquo;beginner-friendly&amp;rdquo; and &amp;ldquo;up-for-grabs&amp;rdquo;, as well as assigning myself to the &amp;ldquo;remove start hangout on air button ticket&amp;rdquo;.  I create a branch and hack out the button to replace it with:&lt;/p&gt;
&lt;pre class="highlight erb"&gt;&lt;code&gt; &lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="n"&gt;button_to&lt;/span&gt; &lt;span class="s1"&gt;'Start Hangout Instructions'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'https://support.google.com/youtube/answer/7083786'&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;which gives us a bit of a boilerplate start:&lt;/p&gt;

&lt;p&gt;&lt;img src="https://dl.dropbox.com/s/ailmb73picj4oxh/Screenshot%202017-11-03%2010.37.37.png?dl=0" /&gt;&lt;/p&gt;

&lt;p&gt;but at least it&amp;rsquo;s a start &amp;hellip; will need some styling - actually that&amp;rsquo;s not too difficult to add:&lt;/p&gt;
&lt;pre class="highlight erb"&gt;&lt;code&gt;&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="n"&gt;button_to&lt;/span&gt; &lt;span class="s1"&gt;'Start Hangout Instructions'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'https://support.google.com/youtube/answer/7083786'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;class: &lt;/span&gt;&lt;span class="s2"&gt;"btn btn-primary"&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and I can also make it open in a new tab:&lt;/p&gt;
&lt;pre class="highlight erb"&gt;&lt;code&gt;&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="n"&gt;button_to&lt;/span&gt; &lt;span class="s1"&gt;'Start Hangout Instructions'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'https://support.google.com/youtube/answer/7083786'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;class: &lt;/span&gt;&lt;span class="s2"&gt;"btn btn-primary"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;form: &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="ss"&gt;target: &lt;/span&gt;&lt;span class="s1"&gt;'_blank'&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;So now we&amp;rsquo;ll have to see what tests that all breaks, but really this needs to get out, since we&amp;rsquo;ve currently got a dangerous broken feature in production &amp;hellip;&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>AV EcoSystem Review Headaches Receding</title>
    <link rel="alternate" href="http://blog.url.com/2017/11/02/av-ecosystem-review-headaches-receding/"/>
    <id>http://blog.url.com/2017/11/02/av-ecosystem-review-headaches-receding/</id>
    <published>2017-11-02T00:00:00+00:00</published>
    <updated>2018-01-16T21:06:46+00:00</updated>
    <author>
      <name>Article Author</name>
    </author>
    <content type="html">&lt;p&gt;&lt;img alt="headaches receding" src="/images/headaches_receding.jpg" /&gt;&lt;/p&gt;

&lt;p&gt;Urgh, minor headache again today, drinking lots of water.  Night before last a Halloween sweeties over-indulged child had caused me broken sleep.  Ended up drinking coffee again, hmm. Somewhat Slack/Email distracted.  Really odd thing is that the fix that I pushed out for the Youtube link over-updates in Slack is that it seems to have fixed the morning &amp;ldquo;Martin Fowler&amp;rdquo; scrum, but not the afternoon &amp;ldquo;Kent Beck&amp;rdquo; scrum.  Of all the different possible outcomes I could have expected &amp;hellip; this is the least predictable.&lt;/p&gt;

&lt;p&gt;I would have imagined that the fix would work, or not work, but not that it would work for one scrum and not the other.  To refresh our memories, the fix was that in the &lt;code&gt;recent_hangouts&lt;/code&gt; method we were adding the &lt;code&gt;duration&lt;/code&gt; FixNum rather than the actual number of minutes when setting the window over which we search for previously running hangouts.  We fixed it by using &lt;code&gt;duration.minutes&lt;/code&gt; to ensure we were using the correct unit:&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;recent_hangouts&lt;/span&gt;
    &lt;span class="n"&gt;event_instances&lt;/span&gt;
      &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'updated_at BETWEEN ? AND ?'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;days&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;ago&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;duration&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;minutes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;DateTime&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;now&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;end_of_day&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;order&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;updated_at: :desc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;My mental model of the bug is complete, except this working for one scrum and not the other.  I&amp;rsquo;m drawn to move on to other things, but this niggles me.  Let&amp;rsquo;s import the production data to my local machine - instructions are here:&lt;/p&gt;

&lt;p&gt;&lt;a href="https://devcenter.heroku.com/articles/heroku-postgres-import-export"&gt;https://devcenter.heroku.com/articles/heroku-postgres-import-export&lt;/a&gt;&lt;/p&gt;
&lt;pre class="highlight shell"&gt;&lt;code&gt;&lt;span class="gp"&gt;$ &lt;/span&gt;heroku pg:backups:capture -r production
&lt;span class="gp"&gt;$ &lt;/span&gt;heroku pg:backups:download -r production
&lt;span class="gp"&gt;$ &lt;/span&gt;pg_restore --verbose --clean --no-acl --no-owner -h localhost -d websiteone_development latest.dump
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;now run the rails console and let&amp;rsquo;s investigate. &lt;/p&gt;
&lt;pre class="highlight plaintext"&gt;&lt;code&gt;[tansaku@Samuels-MBP:~/Documents/Github/AgileVentures/WebsiteOne (develop)]$ 
→ be rails c
Loading development environment (Rails 4.2.10)
[1] pry(main)&amp;gt; DateTime.now.end_of_day
=&amp;gt; Thu, 02 Nov 2017 23:59:59 +0000
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I wonder if it relates to the time zone on the server?&lt;/p&gt;
&lt;pre class="highlight plaintext"&gt;&lt;code&gt;→ heroku run rails c -r production
Running rails c on ⬢ websiteone-production... ⣟ connecting, run.9360 ⢿Standard-1X)
                                              ⣷
Running rails c on ⬢ websiteone-production... up, run.9360 (Standard-1X)
DateTime.now.end_of_day

Loading production environment (Rails 4.2.10)
irb(main):001:0&amp;gt; DateTime.now.end_of_day
=&amp;gt; Thu, 02 Nov 2017 23:59:59 +0000
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Okay, both server and my local machine running in UTC it seems &amp;hellip;  I potter about looking at the scrums, and I think I know the issue.  We are looking at the &lt;code&gt;updated_at&lt;/code&gt; time rather than &lt;code&gt;created_at&lt;/code&gt; and if I push the video attachment later then the previous days scrum is showing up in the active window.  So options include switching like so:&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;recent_hangouts&lt;/span&gt;
    &lt;span class="n"&gt;event_instances&lt;/span&gt;
      &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'created_at BETWEEN ? AND ?'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;days&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;ago&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;duration&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;minutes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;DateTime&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;now&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;end_of_day&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;order&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;created_at: :desc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;updated_at&lt;/code&gt; was more important when we had the Google hangout API live pinging our system, which doesn&amp;rsquo;t happen now.  Maybe we can get that again with Jitsi, but even then I&amp;rsquo;m not sure this &lt;code&gt;recent_hangouts&lt;/code&gt; method needs to work against the updated_at info - let&amp;rsquo;s make that change and see if if breaks any tests &amp;hellip; while that&amp;rsquo;s running I can think about the test that might expose the flaw &amp;hellip; (all the hangout cukes pass).&lt;/p&gt;

&lt;p&gt;Funny running the full set I got a new error I never saw:&lt;/p&gt;
&lt;pre class="highlight plaintext"&gt;&lt;code&gt;SecurityError: DOM Exception 18: An attempt was made to break through the security policy of the user agent.

  phantomjs://code/connection.js:9
  phantomjs://code/connection.js:9 in Connection
  phantomjs://code/main.js:8 in Poltergeist
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In the meantime I think I saw how a simple change to &lt;code&gt;updated_at&lt;/code&gt; in the database setup for my original bug fix test could expose this wrinkle on the issue &amp;hellip; yes, if I set the last &lt;code&gt;updated_at&lt;/code&gt; value of the previous scrum to after the duration of the event then I see the bug I was getting in production.  So the current bug-wrapping scenario stays as it was, and for good measure I add a comment to the issue in question:&lt;/p&gt;
&lt;pre class="highlight gherkin"&gt;&lt;code&gt;  &lt;span class="c"&gt;# wraps bug described in https://github.com/AgileVentures/WebsiteOne/issues/1809&lt;/span&gt;
  &lt;span class="kn"&gt;Scenario&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; Event doesn't ping old youtube URL
    &lt;span class="err"&gt;Given the date is "2014 Feb 5th 6&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="err"&gt;59am"&lt;/span&gt;
    &lt;span class="nf"&gt;And&lt;/span&gt; that we're spying on the SlackService
    &lt;span class="nf"&gt;When&lt;/span&gt; I manually set a hangout link for event &lt;span class="s"&gt;"Repeat Scrum"&lt;/span&gt;
    &lt;span class="nf"&gt;Then&lt;/span&gt; the Hangout URL is posted in Slack
    &lt;span class="nf"&gt;And&lt;/span&gt; the Youtube URL is not posted in Slack
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and then having checked that the test captures the bug (perhaps ideally the test itself should explicitly set the &lt;code&gt;updated_at&lt;/code&gt; value?) and then fixed it again I push things up to see how the CI handles them.  I&amp;rsquo;ll add that change as a refactoring ticket and move on I think - running out of time today.  Really want to get this all into production and have it sorted to put my mind at rest &amp;hellip;&lt;/p&gt;

&lt;p&gt;&lt;a href="https://github.com/AgileVentures/WebsiteOne/issues/1939"&gt;https://github.com/AgileVentures/WebsiteOne/issues/1939&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As &lt;a href="https://medium.com/@cess/agile-ventures-experience-629c0e3028b0"&gt;Cess says &amp;ldquo;sips coffee, grabs another ticket&amp;rdquo;&lt;/a&gt; although I&amp;rsquo;ll be grabbing an admin task or two I think &amp;hellip; :-)&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>AV EcoSystem Review Headaches</title>
    <link rel="alternate" href="http://blog.url.com/2017/11/01/av-ecosystem-review-headaches/"/>
    <id>http://blog.url.com/2017/11/01/av-ecosystem-review-headaches/</id>
    <published>2017-11-01T00:00:00+00:00</published>
    <updated>2018-01-15T21:01:34+00:00</updated>
    <author>
      <name>Article Author</name>
    </author>
    <content type="html">&lt;p&gt;&lt;img alt="headache" src="/images/headache.jpg" /&gt;&lt;/p&gt;

&lt;p&gt;I&amp;rsquo;m feeling a bit rough - maybe coming down with something.  Bit of a headache at the computer.  Have burnt early start on handing off the AgileVentures sticker send out.  Will it actually make sense to make a shop front where folks can buy stickers and other AgileVentures swag?  Would that ever he anything other than a trivial source of revenue?&lt;/p&gt;

&lt;p&gt;Just had to stop to put on warm clothing as it cools down here in the UK.  Headaches literally and figuratively. Drink lots of water and ease myself into the day.  So, heroku had issues all day yesterday and I &lt;em&gt;think&lt;/em&gt; we deployed the fixes for old youtube links being pinged, but we still had the same problem in the Kent Beck scrum yesterday afternoon.  I had deployed manually and got an odd message at the end of the deploy:&lt;/p&gt;
&lt;pre class="highlight plaintext"&gt;&lt;code&gt;remote: -----&amp;gt; Launching...
remote:        Released v296
remote:        https://websiteone-production.herokuapp.com/ deployed to Heroku
remote: 
remote: Verifying deploy... done.
error: Could not read c93108679daff7e04ea8d6408b172c1aed987389
fatal: Failed to traverse parents of commit 600ecd2a36175294d8ba8a18e8b0f0c318402487
error: failed to run repack
To heroku.com:websiteone-production.git
   a3521705..259467f6  master -&amp;gt; master
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I guess the deploy worked - would be nice if we had a page somewhere in the site that told us what commit it was on.  Actually Heroku shows us that and it does seem like it&amp;rsquo;s deployed.  So is the fix I thought I had applied not working in production &amp;hellip;? I guess I see how it goes today and then circle back on it tomorrow and do a local test with production data if it&amp;rsquo;s still an issue.&lt;/p&gt;

&lt;p&gt;So the real headache is choosing where to focus next.  I generated a big list of things yesterday from reviewing the WebSiteOne waffle board.  There are good reasons for working on any number of them.  But maybe the backlog of PRs from dependabot and open stuff in the waffle board is the real challenge?  What I could do with is, say, five other volunteers working on this semi-regularly with me.&lt;/p&gt;

&lt;p&gt;My inclination is to say that we need to push some of our AdWords budget at promoting our mob programming sessions.  And I don&amp;rsquo;t want to wait to have created a sign up form.  We are doing sign up via people following us on twitter and liking our page on facebook.  The target can be having people click through to our social media links.  I&amp;rsquo;m also frustrated that I&amp;rsquo;m not feeling more comfortable with Google AdWords.  It feels like it should be a simple thing to use, but somehow my mental model is not quite there.  Part of me thinks I need to read up on Adwords, or take a course, but I have terrible trouble focusing on stuff I&amp;rsquo;m not interacting with, things that I can&amp;rsquo;t interactively test.  It&amp;rsquo;s like I&amp;rsquo;m deeply suspicious that anything written down will not be up to date.&lt;/p&gt;

&lt;p&gt;Anyway, so I start by creating a Google Ad Campaign.  Immediately there are choices between &amp;ldquo;Search Network with Display Select&amp;rdquo; and &amp;ldquo;Search Network Only&amp;rdquo;.  I read an article about the difference, but have no real way to judge the value of one over the other to us, so I go with &amp;ldquo;Search Network Only&amp;rdquo; which is what all our current campaigns are.&lt;/p&gt;

&lt;p&gt;&lt;img src="https://dl.dropbox.com/s/79slyq3k2slwmsl/Screenshot%202017-11-01%2010.15.04.png?dl=0" /&gt;&lt;/p&gt;

&lt;p&gt;I throw in our landing page and some random keywords:&lt;/p&gt;

&lt;p&gt;&lt;img src="https://dl.dropbox.com/s/y4ngbqedas629wf/Screenshot%202017-11-01%2010.18.22.png?dl=0" /&gt;&lt;/p&gt;

&lt;p&gt;And then I get the view I love, the one where we can see the form of the ad:&lt;/p&gt;

&lt;p&gt;&lt;img src="https://dl.dropbox.com/s/j399vz9voklwg3c/Screenshot%202017-11-01%2010.20.34.png?dl=0" /&gt;&lt;/p&gt;

&lt;p&gt;So now we have a campagin that is ready to go.  I&amp;rsquo;m not actually sure how to kick it off, maybe it&amp;rsquo;s started already?  I&amp;rsquo;m not sure how we set the targets for the campaign.  I&amp;rsquo;d like success to be folks clicking through to http://facebook.com/agileventures or http://twitter.com/agileventures.  I find that there&amp;rsquo;s a process of creating conversions, which seems to involve javascript.  Not sure that will play well with out mercury editable pages.  Okay, I&amp;rsquo;m going to leave it there for today and see if I can engage the rest of the marketing team on this.&lt;/p&gt;

&lt;p&gt;what I would like to do is add a video of an example session to the premium mob page, which I do and then I go to make coffee.  Still on the decaf - could use a hit of real coffee about now, but not sure that will help in the long run &amp;hellip;&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>AV EcoSystem Review Making Events Welcoming</title>
    <link rel="alternate" href="http://blog.url.com/2017/10/31/av-ecosystem-review-making-events-welcoming/"/>
    <id>http://blog.url.com/2017/10/31/av-ecosystem-review-making-events-welcoming/</id>
    <published>2017-10-31T00:00:00+00:00</published>
    <updated>2018-01-15T20:57:00+00:00</updated>
    <author>
      <name>Article Author</name>
    </author>
    <content type="html">&lt;p&gt;&lt;img alt="welcoming" src="/images/welcoming.png" /&gt;&lt;/p&gt;

&lt;p&gt;So I have the new code on staging to avoid reposting old YouTube URLs on Slack. So let&amp;rsquo;s start by pushing that out to production:&lt;/p&gt;
&lt;pre class="highlight plaintext"&gt;&lt;code&gt;[tansaku@Samuels-MBP:~/Documents/Github/AgileVentures/WebsiteOne (staging)]$ 
→ git pull origin staging
warning: redirecting to https://github.com/AgileVentures/WebsiteOne/
From http://github.com/AgileVentures/WebsiteOne
 * branch              staging    -&amp;gt; FETCH_HEAD
Already up-to-date.
[tansaku@Samuels-MBP:~/Documents/Github/AgileVentures/WebsiteOne (staging)]$ 
→ git checkout master
Switched to branch 'master'
[tansaku@Samuels-MBP:~/Documents/Github/AgileVentures/WebsiteOne (master)]$ 
→ git rebase staging
First, rewinding head to replay your work on top of it...
Fast-forwarded master to staging.
[tansaku@Samuels-MBP:~/Documents/Github/AgileVentures/WebsiteOne (master)]$ 
→ git push origin master
warning: redirecting to https://github.com/AgileVentures/WebsiteOne/
Total 0 (delta 0), reused 0 (delta 0)
To http://github.com/AgileVentures/WebsiteOne
   a3521705..259467f6  master -&amp;gt; master
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Hopefully that will be one less thing to worry about this week.  Now the other issue was the one pointed out by Will, that having the YouTube message being almost identical to the hangout link, which can be confusing.  We have a ticket for that:&lt;/p&gt;

&lt;p&gt;&lt;a href="https://github.com/AgileVentures/WebsiteOne/issues/1921"&gt;https://github.com/AgileVentures/WebsiteOne/issues/1921&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I kicked off an asynchronous vote in the websiteone channel.  I&amp;rsquo;m conflicted about whether this is the thing to work on.  I really want our events to be as welcoming as possible, but there&amp;rsquo;s so many potentially valuable things in the waffle board.  Let&amp;rsquo;s at least start this one; although then again, maybe that&amp;rsquo;s the wrong approach.  Perhaps I should be clearing out existing and stale tickets.  The challenge with this ticket is that I&amp;rsquo;ve put the welcoming message in the title of the main daily scrums:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&amp;ldquo;Martin Fowler&amp;rdquo; Scrum and Pair Hookup - All Welcome :-) Discuss Any Project, Ask Any Question, Or Just Listen In :-)&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;and the YouTube slack ping is using the following ruby to generate the hyperlink:&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="n"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"&amp;lt;&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;video&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;|Video/Livestream for &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;hangout&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;title&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;gt;"&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;so the entire title appears in the hyperlink.  Perhaps the solution would be:&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="n"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"&amp;lt;&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;video&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;|Click here to listen in to the Video/Livestream&amp;gt; for &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;hangout&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;title&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I&amp;rsquo;m caught between not wanting to have the welcoming message appear on everbody&amp;rsquo;s scrum events, and wanting to be able to refer to the title separately.  &lt;/p&gt;

&lt;p&gt;The message for the hangout link is as follows:&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="n"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"&amp;lt;&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;hangout&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;hangout_url&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;|&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;hangout&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;title&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;gt;"&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and maybe it should be &lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="n"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"&amp;lt;&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;hangout&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;hangout_url&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;|Click here to participate in&amp;gt; &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;hangout&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;title&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;although I guess we&amp;rsquo;d acutally like the folks who want to listen in to actually join the hangout (as Will did) so that we can get them talking &amp;hellip; hmm :-)  Maybe a reasonable compromise would be:&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="n"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"&amp;lt;&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;video&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;|Video/Livestream&amp;gt; for &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;hangout&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;title&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Part of the issue is that it&amp;rsquo;s difficult to judge it until one sees how it actually appears in Slack.  Which makes me wonder if I can run it locally for one of our Slack test instances.  In the background Heroku is having issues and I can&amp;rsquo;t deploy yesterday&amp;rsquo;s fix to production :-(&lt;/p&gt;

&lt;p&gt;Thinking back about the AV ecosystem review philosophy I recall that my last idea starting from the ads we serve on Google is that we could be serving ads about the free access to mobs and f2f sessions.  We could just do that on Google, but we&amp;rsquo;re talking about a signup form that allows us to track how many are signing up from particular campaigns.  Which is then another thing that sits on the TODO list and blocks us from using the Google ad revenue from working on something that might actually lead to new sign ups for paid services, which would be obvious whether we are tracking how many people signed up for them or not &amp;hellip; could we be tracking the social media likes and follows?&lt;/p&gt;

&lt;p&gt;Other things are:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;performance issues on the site&lt;/li&gt;
&lt;li&gt;tawk.to site integrated chat system&lt;/li&gt;
&lt;li&gt;replacing the mercury editor so we can move to Rails 5&lt;/li&gt;
&lt;li&gt;supporting private events&lt;/li&gt;
&lt;li&gt;looking at long running cukes&lt;/li&gt;
&lt;li&gt;hosting our own jitsi&lt;/li&gt;
&lt;li&gt;making the main page counter dynamic&lt;/li&gt;
&lt;li&gt;notifying the project creator when people join a project&lt;/li&gt;
&lt;li&gt;having getting started page tick off progress&lt;/li&gt;
&lt;li&gt;better modelling of premium users&lt;/li&gt;
&lt;li&gt;allowing premium users to change payment methods&lt;/li&gt;
&lt;li&gt;start hangout button not working &amp;hellip;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I don&amp;rsquo;t think I&amp;rsquo;ve experienced any 500 timeouts on the events pages since we rolled out the the icecube upgrade.  I&amp;rsquo;m conflicted about tawk.to after seeing OdinProjects lovely gitter integration.  Replacing the mercury editor feels like a big job.  Corey seems to be stalled working on private events.  The cukes are an ongoing bleed.  I should look at jitsi with Sigu &amp;hellip; making the main page counter dynamic would probably help us look more professional.  Notifying project creators when people click to join their projects could help connect people, as could adding some progress tracking to the &amp;ldquo;getting started&amp;rdquo; pages.  Better modelling of all the Premium users would probably make my life easier and support better predictions, while allowing Premiums to change payment plans would help money flow.  The Start Hangout button not working is a nasty fail point for newcomers trying to pair - particularly those starting the MOOC &amp;hellip;&lt;/p&gt;

&lt;p&gt;Gosh, I&amp;rsquo;m really not sure what to work on and the time change means the scrum is coming up soon.  I think I&amp;rsquo;ll have to leave it there today.  I really do want to make events more welcoming, but I think I need to spend some more time reflecting on how to divide up my labour &amp;hellip;&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>AV EcoSystem Review Dripping Tap</title>
    <link rel="alternate" href="http://blog.url.com/2017/10/30/av-ecosystem-review-dripping-tap/"/>
    <id>http://blog.url.com/2017/10/30/av-ecosystem-review-dripping-tap/</id>
    <published>2017-10-30T00:00:00+00:00</published>
    <updated>2018-01-15T20:57:00+00:00</updated>
    <author>
      <name>Article Author</name>
    </author>
    <content type="html">&lt;p&gt;&lt;img alt="dripping tap" src="/images/dripping_tap.jpg" /&gt;&lt;/p&gt;

&lt;p&gt;Back after a break, getting back into the routine.  One thing being away highlighted was that we have awesome enthusiastic new members who have the run the scrums while I was away, and awesome enthusiastic long term members (i.e. federico) running the mobs and marketing meetings.  Having other folks start the scrums highlighted one of the outstanding niggles that we have with the new manual updates that Lokesh was working on over the summer.  For those scrums that repeat daily, pushing a new hangout live seems to also push out the youtube link from the previous day.&lt;/p&gt;

&lt;p&gt;I&amp;rsquo;d been coping with this by simply deleting the incorrect link, but that&amp;rsquo;s a hacky manual fix that&amp;rsquo;s going to flummox any new folks.  It&amp;rsquo;s been a dripping tap for a while.  Does it indicate that I&amp;rsquo;m fundamentally incompetent that I haven&amp;rsquo;t fixed it or got someone to fix it?  I hope not.  There always seems to be fifty different things that need to be done and it&amp;rsquo;s usually unclear what the long term pros and cons of each will be.  Okay, no more navel-gazing, let&amp;rsquo;s see if we can fix this issue that burns up my time, and is confusing for others.&lt;/p&gt;

&lt;p&gt;The confusing thing about this bug is that it took me a while to work out the pattern of when it occurred.  Specifically it only occurs when there was an event of the same type that ran the day before, and then not every time.  I think it may be occurring when an event is started within 24 hours of the previous event.  I had previously opened a ticket on the subject:&lt;/p&gt;

&lt;p&gt;&lt;a href="https://github.com/AgileVentures/WebsiteOne/issues/1809"&gt;https://github.com/AgileVentures/WebsiteOne/issues/1809&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So the clear procedure here would be to try and replicate the issue with a cucumber test.  Although I can&amp;rsquo;t seem to help myself but first have a little gander at the code that I think might cause the problem.  The EventsController grabs the most recent_hangout like so:&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;show&lt;/span&gt;
    &lt;span class="vi"&gt;@event_schedule&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="vi"&gt;@event&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;next_occurrences&lt;/span&gt;
    &lt;span class="vi"&gt;@recent_hangout&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="vi"&gt;@event&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;recent_hangouts&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;first&lt;/span&gt;
    &lt;span class="n"&gt;render&lt;/span&gt; &lt;span class="ss"&gt;partial: &lt;/span&gt;&lt;span class="s1"&gt;'hangouts_management'&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;xhr?&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and the form for manually updating the event includes the YouTube URL from this &lt;code&gt;@recent_hangout&lt;/code&gt;:&lt;/p&gt;
&lt;pre class="highlight erb"&gt;&lt;code&gt;&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="n"&gt;hidden_field_tag&lt;/span&gt; &lt;span class="s1"&gt;'yt_url'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="vi"&gt;@recent_hangout&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;try!&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:yt_url&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;the &lt;code&gt;@recent_hangout&lt;/code&gt; is grabbed from the database by some code in the events model:&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;recent_hangouts&lt;/span&gt;
    &lt;span class="n"&gt;event_instances&lt;/span&gt;
      &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'updated_at BETWEEN ? AND ?'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;days&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;ago&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;duration&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;DateTime&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;now&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;end_of_day&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;order&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;updated_at: :desc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I wonder if we need a different date range in here &amp;hellip;?  So here&amp;rsquo;s where I might run off into spiking code, so I drop back to create a new Cucumber scenario:&lt;/p&gt;
&lt;pre class="highlight gherkin"&gt;&lt;code&gt;  &lt;span class="kn"&gt;Scenario&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; Event doesn't ping old youtube URL
    &lt;span class="err"&gt;Given the date is "2014 Feb 5th 6&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="err"&gt;59am"&lt;/span&gt;
    &lt;span class="nf"&gt;And&lt;/span&gt; that we're spying on the SlackService
    &lt;span class="nf"&gt;When&lt;/span&gt; I manually set a hangout link for event &lt;span class="s"&gt;"Repeat Scrum"&lt;/span&gt;
    &lt;span class="nf"&gt;Then&lt;/span&gt; the Hangout URL is posted in Slack
    &lt;span class="nf"&gt;And&lt;/span&gt; the Youtube URL is not posted in Slack
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;which relies on a couple of new step definitions&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="no"&gt;And&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sr"&gt;/^that we're spying on the SlackService$/&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;allow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;SlackService&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;to&lt;/span&gt; &lt;span class="n"&gt;receive&lt;/span&gt; &lt;span class="ss"&gt;:post_yt_link&lt;/span&gt;
  &lt;span class="n"&gt;allow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;SlackService&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;to&lt;/span&gt; &lt;span class="n"&gt;receive&lt;/span&gt; &lt;span class="ss"&gt;:post_hangout_notification&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="no"&gt;Then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sr"&gt;/^the Youtube URL is not posted in Slack$/&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;SlackService&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;not_to&lt;/span&gt; &lt;span class="n"&gt;have_received&lt;/span&gt; &lt;span class="ss"&gt;:post_yt_link&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="no"&gt;And&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sr"&gt;/^the Hangout URL is posted in Slack$/&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;SlackService&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;to&lt;/span&gt; &lt;span class="n"&gt;have_received&lt;/span&gt; &lt;span class="ss"&gt;:post_hangout_notification&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and we catch the error we&amp;rsquo;ve been experiencing in the live system:&lt;/p&gt;
&lt;pre class="highlight shell"&gt;&lt;code&gt;  Scenario: Event doesn&lt;span class="s1"&gt;'t ping old youtube URL                  # features/hangouts/edit_hangout_url.feature:41
    Given the date is "2014 Feb 5th 6:59am"                     # features/step_definitions/event_steps.rb:94
    And that we'&lt;/span&gt;re spying on the SlackService                   &lt;span class="c"&gt;# features/step_definitions/hangout_steps.rb:212&lt;/span&gt;
    When I manually &lt;span class="nb"&gt;set &lt;/span&gt;a hangout link &lt;span class="k"&gt;for &lt;/span&gt;event &lt;span class="s2"&gt;"Repeat Scrum"&lt;/span&gt; &lt;span class="c"&gt;# features/step_definitions/hangout_steps.rb:108&lt;/span&gt;
    Then the Hangout URL is posted &lt;span class="k"&gt;in &lt;/span&gt;Slack                     &lt;span class="c"&gt;# features/step_definitions/hangout_steps.rb:221&lt;/span&gt;
    And the Youtube URL is not posted &lt;span class="k"&gt;in &lt;/span&gt;Slack                  &lt;span class="c"&gt;# features/step_definitions/hangout_steps.rb:217&lt;/span&gt;
      &lt;span class="o"&gt;(&lt;/span&gt;SlackService&lt;span class="o"&gt;)&lt;/span&gt;.post_yt_link&lt;span class="o"&gt;(&lt;/span&gt;no args&lt;span class="o"&gt;)&lt;/span&gt;
          expected: 0 &lt;span class="nb"&gt;times &lt;/span&gt;with any arguments
          received: 1 &lt;span class="nb"&gt;time&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;RSpec::Mocks::MockExpectationError&lt;span class="o"&gt;)&lt;/span&gt;
      ./features/step_definitions/hangout_steps.rb:218:in &lt;span class="sb"&gt;`&lt;/span&gt;/^the Youtube URL is not posted &lt;span class="k"&gt;in &lt;/span&gt;Slack&lt;span class="nv"&gt;$/&lt;/span&gt;&lt;span class="s1"&gt;'
      features/hangouts/edit_hangout_url.feature:46:in `And the Youtube URL is not posted in Slack'&lt;/span&gt;

Failing Scenarios:
cucumber features/hangouts/edit_hangout_url.feature:41 &lt;span class="c"&gt;# Scenario: Event doesn't ping old youtube URL&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;So can we fix it?  I think the date range must be wrong somehow - beginning of day vs end of day, or subtract the duration rather than adding it &amp;hellip; my intuitions are not bearing fruit - I hook the thing on the debugger:&lt;/p&gt;
&lt;pre class="highlight shell"&gt;&lt;code&gt;&lt;span class="o"&gt;[&lt;/span&gt;212, 221] &lt;span class="k"&gt;in&lt;/span&gt; /Users/tansaku/Documents/GitHub/AgileVentures/WebsiteOne/app/models/event.rb
   212: 
   213:   def recent_hangouts
   214:     debugger
   215:     event_instances
   216:       .where&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'updated_at BETWEEN ? AND ?'&lt;/span&gt;, 1.days.ago + duration, DateTime.now.end_of_day&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;=&amp;gt; &lt;/span&gt;217:       .order&lt;span class="o"&gt;(&lt;/span&gt;updated_at: :desc&lt;span class="o"&gt;)&lt;/span&gt;
   218:   end
   219: 
   220:   def less_than_ten_till_start?
   221:     &lt;span class="k"&gt;return &lt;/span&gt;&lt;span class="nb"&gt;true &lt;/span&gt;&lt;span class="k"&gt;if &lt;/span&gt;within_current_event_duration?
&lt;span class="o"&gt;(&lt;/span&gt;byebug&lt;span class="o"&gt;)&lt;/span&gt; 1.days.ago + duration
Tue, 04 Feb 2014 06:59:22 UTC +00:00
&lt;span class="o"&gt;(&lt;/span&gt;byebug&lt;span class="o"&gt;)&lt;/span&gt; DateTime.now.end_of_day
Wed, 05 Feb 2014 23:59:59 +0000
&lt;span class="o"&gt;(&lt;/span&gt;byebug&lt;span class="o"&gt;)&lt;/span&gt; event_instances.where&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'updated_at BETWEEN ? AND ?'&lt;/span&gt;, 1.days.ago + duration, DateTime.now.end_of_day&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="c"&gt;#&amp;lt;ActiveRecord::AssociationRelation [#&amp;lt;EventInstance id: 2, event_id: 2, title: "HangoutsFlow", hangout_url: "http://hangout.test", created_at: "2014-02-04 07:00:00", updated_at: "2014-02-04 07:03:00", uid: "100", category: "Scrum", project_id: nil, user_id: 1, yt_video_id: "QWERT55", participants: {"0"=&amp;gt;{"id"=&amp;gt;"hangout2750757B_ephemeral.id.google.com^a85dcb4670", "hasMicrophone"=&amp;gt;"true", "hasCamera"=&amp;gt;"true", "hasAppEnabled"=&amp;gt;"true", "isBroadcaster"=&amp;gt;"true", "isInBroadcast"=&amp;gt;"true", "displayIndex"=&amp;gt;"0", "person"=&amp;gt;{"id"=&amp;gt;"108533475599002820142", "displayName"=&amp;gt;"Alejandro Babio", "image"=&amp;gt;{"url"=&amp;gt;"https://lh4.googleusercontent.com/-p4ahDFi9my0/AAAAAAAAAAI/AAAAAAAAAAA/n-WK7pTcJa0/s96-c/photo.jpg"}, "na"=&amp;gt;"false"}, "locale"=&amp;gt;"en", "na"=&amp;gt;"false"}}, hoa_status: "started", url_set_directly: true, youtube_tweet_sent: false&amp;gt;]&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I think I see the problem - this duration addition is not working &amp;hellip;&lt;/p&gt;
&lt;pre class="highlight shell"&gt;&lt;code&gt;&lt;span class="o"&gt;(&lt;/span&gt;byebug&lt;span class="o"&gt;)&lt;/span&gt; 1.days.ago + duration
Tue, 04 Feb 2014 07:00:00 UTC +00:00
&lt;span class="o"&gt;(&lt;/span&gt;byebug&lt;span class="o"&gt;)&lt;/span&gt; 1.days.ago
Tue, 04 Feb 2014 06:59:52 UTC +00:00
&lt;span class="o"&gt;(&lt;/span&gt;byebug&lt;span class="o"&gt;)&lt;/span&gt; 1.days.ago + 30.minutes
Tue, 04 Feb 2014 07:30:22 UTC +00:00
&lt;span class="o"&gt;(&lt;/span&gt;byebug&lt;span class="o"&gt;)&lt;/span&gt; 1.days.ago + duration.minutes
Tue, 04 Feb 2014 07:15:27 UTC +00:00
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This is the fix:&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;recent_hangouts&lt;/span&gt;
    &lt;span class="n"&gt;event_instances&lt;/span&gt;
      &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'updated_at BETWEEN ? AND ?'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;days&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;ago&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;duration&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;minutes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;DateTime&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;now&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;end_of_day&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;order&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;updated_at: :desc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;but will it break lots of other things? The other scenarios in that feature pass, so I push the fix up onto the bugfix branch and let the CI run, while kicking off the full set of hangout features locally.  The cukes still take a long time to run even on my local machine (&amp;gt;10 minutes), so I tend to run them in small batches.  Another dripping tap perhaps &amp;hellip;&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>AV EcoSystem Review Performance Tuning FTW</title>
    <link rel="alternate" href="http://blog.url.com/2017/10/20/av-ecosystem-review-performance-tuning-ftw/"/>
    <id>http://blog.url.com/2017/10/20/av-ecosystem-review-performance-tuning-ftw/</id>
    <published>2017-10-20T01:00:00+01:00</published>
    <updated>2018-01-15T20:57:01+00:00</updated>
    <author>
      <name>Article Author</name>
    </author>
    <content type="html">&lt;p&gt;&lt;img alt="performance tuning" src="/images/performance_tuning.jpg" /&gt;&lt;/p&gt;

&lt;p&gt;Late to the blogface yada, yada, yada.  I&amp;rsquo;m really enjoying performance tuning.  Let&amp;rsquo;s take another look at what&amp;rsquo;s going on.  I can see from yesterday&amp;rsquo;s test runs that I quickly pushed the AV site into to heavy memory error territory.  I also restarted the server after the tests and what&amp;rsquo;s interesting is to see that we actually start encountering memory errors on the staging server in the absence of performance testing:&lt;/p&gt;

&lt;p&gt;&lt;img alt="heroku metrics" src="https://dl.dropbox.com/s/532rzq46emgci3h/Screenshot%202017-10-20%2010.19.45.png?dl=0" /&gt;&lt;/p&gt;

&lt;p&gt;The staging server is not coming under any particular load, which implies that we&amp;rsquo;ve got some sort of memory leak just in the resting state of the server.  Not ideal.  It&amp;rsquo;s also clear that the simple throw money at the problem would be to double the size of the memory, and help Heroku with their bottom line, but it would be far more satisfying to actually solve the problem.  I&amp;rsquo;ve had no follow up on my question in the issues of &lt;code&gt;derailed_benchmarks&lt;/code&gt; about why we get an error running &lt;code&gt;perf:mem_over_time&lt;/code&gt; on the production app locally.  However the Heroku metrics indicate we do have a memory leak, so perhaps we can skip that and move on the analysis phase.  All the &lt;code&gt;perf:mem_over_time&lt;/code&gt; operation tells us is that we are using 211MiB on startup, which I can see matches the restart value for memory usage on heroku.  Let&amp;rsquo;s try the &amp;ldquo;Dissecting a Memory Leak&amp;rdquo; suggestion: &lt;code&gt;perf:objects&lt;/code&gt;.  That may just hit the same error, and in fact is does. &lt;/p&gt;

&lt;p&gt;I had two quick ideas for fixes - turning off https locally and checking that I can see the app in a browser running locally in production mode.  I did the former and was able to do the latter, and didn&amp;rsquo;t see an improvement.  But then realised I was turning off https in LocalSupport, not WebSiteOne.  I switched that off and we were in business:&lt;/p&gt;
&lt;pre class="highlight plaintext"&gt;&lt;code&gt;→ AIRBRAKE_PROJECT_ID=6 AIRBRAKE_API_KEY=b681e09 bundle exec derailed exec perf:mem_over_time
Booting: production
Endpoint: "/"
/Users/tansaku/.rvm/gems/ruby-2.3.1/gems/derailed_benchmarks-1.3.2/lib/derailed_benchmarks/tasks.rb:72: warning: already initialized constant DERAILED_APP
/Users/tansaku/.rvm/gems/ruby-2.3.1/gems/derailed_benchmarks-1.3.2/lib/derailed_benchmarks/tasks.rb:23: warning: previous definition of DERAILED_APP was here
PID: 92587
213.2734375
237.4296875
247.52734375
252.6953125
257.9375
260.125
262.21875
265.7578125
272.25
274.1640625
274.796875
275.80078125
276.546875
277.171875
277.60546875
278.09375
278.6015625
278.8359375
279.28125
281.1171875
281.26953125
281.390625
281.57421875
281.67578125
281.859375
281.03125
270.57421875
270.9296875
271.6640625
271.984375
272.671875
250.19921875
251.328125
242.16015625
240.8203125
241.41796875
241.546875
...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;So what we are waiting to see here is if the memory never levels off.  Another waiting activity.  And actually sometimes the memory level is dropping before gradually creeping up again - hmmm.  And nowhere near the levels we&amp;rsquo;re seeing running this on Heroku.  Of course this test is profiling what&amp;rsquo;s happening locally on the OSX machine, not whatever virtual machine is in use on Heroku.  Here&amp;rsquo;s our puma config:&lt;/p&gt;
&lt;pre class="highlight plaintext"&gt;&lt;code&gt;workers Integer(ENV['PUMA_WORKERS'] || 3)
threads Integer(ENV['MIN_THREADS']  || 1), Integer(ENV['MAX_THREADS'] || 16)

preload_app!

rackup      DefaultRackup
port        ENV['PORT']     || 3000
environment ENV['RACK_ENV'] || 'development'

on_worker_boot do
  # worker specific setup
  ActiveSupport.on_load(:active_record) do
    config = ActiveRecord::Base.configurations[Rails.env] ||
                Rails.application.config.database_configuration[Rails.env]
    config['pool'] = ENV['MAX_THREADS'] || 16
    ActiveRecord::Base.establish_connection(config)
  end
end
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;So things we could try include:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;reducing the number of puma workers (although we have 2 on staging and 1 on production already)&lt;/li&gt;
&lt;li&gt;try a puma worker killer&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Other things that spring to mind are adjusting the number of threads (MAX&lt;em&gt;THREADS = 3 on staging, 2 on production), but I think we had a round of tweaking puma workers and threads to no avail.   The rest of this Puma config looks okay.  RACK&lt;/em&gt;ENV must be production &amp;hellip; but now I can run &lt;code&gt;perf:objects&lt;/code&gt; and I get the following info about which gems are allocating the most memory:&lt;/p&gt;
&lt;pre class="highlight plaintext"&gt;&lt;code&gt;allocated memory by gem
-----------------------------------
   7874184  ice_cube-0.11.1
   7862554  activesupport-4.2.10
   1372984  tzinfo-1.2.3
    760790  ruby-2.3.1/lib
    751451  activerecord-4.2.10
    121937  WebsiteOne/app
    114186  newrelic_rpm-4.1.0.333
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and the retained memory by location:&lt;/p&gt;
&lt;pre class="highlight plaintext"&gt;&lt;code&gt;retained memory by location
-----------------------------------
     23609  /Users/tansaku/Documents/GitHub/AgileVentures/WebsiteOne/app/views/visitors/index.html.erb:1
      5200  /Users/tansaku/.rvm/gems/ruby-2.3.1/gems/newrelic_rpm-4.1.0.333/lib/new_relic/agent/transaction/trace_node.rb:24
      5016  /Users/tansaku/.rvm/gems/ruby-2.3.1/gems/newrelic_rpm-4.1.0.333/lib/new_relic/agent/transaction/trace.rb:54
      3384  /Users/tansaku/.rvm/gems/ruby-2.3.1/gems/rack-1.6.8/lib/rack/mock.rb:92
      2240  /Users/tansaku/.rvm/gems/ruby-2.3.1/gems/newrelic_rpm-4.1.0.333/lib/new_relic/agent/transaction/trace_node.rb:35
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and various other stuff that makes it feel like it&amp;rsquo;s the event scheduling time and timezone stuff that&amp;rsquo;s causing the biggest memory headaches.  The Puma worker killer is a stop gap.  I guess the best looking options are:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;try removing the &lt;code&gt;nearest_time_zone&lt;/code&gt; gem since it&amp;rsquo;s the biggest memory hog&lt;/li&gt;
&lt;li&gt;dissect the visitors index.html.erb file to work out where it&amp;rsquo;s snagging on memory&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;I tried removing the timing section and re-running the memory performance over time, but it just jumped up.  I ran the perf:objects again and that knocked the index.html.erb file out of the &amp;ldquo;retained memory by location&amp;rdquo; list.  I notice that the home page is not using the application layout for some reason.  Time with zone from active&lt;em&gt;support is still being heavily used.  It seems like ice&lt;/em&gt;cube is being heavily activated, even when I think I&amp;rsquo;ve removed the time/scheduling stuff from the home page.  I wonder if that&amp;rsquo;s just its resting state &amp;hellip;?  I run the analysis again removing everything from the home page and yes the icecube stuff disappears.  It looks like we are rendering other sub-elements that are pulling in info on event scheduling hmmm &amp;hellip; so I guess I should analyze the different partials:&lt;/p&gt;

&lt;p&gt;1) &lt;em&gt;head.html.erb: javascript and stylesheet include tags - nothing suspicious
2) _navbar.html.erb: checks if user is signed in, user presentation, checking for next event (avoided on home page?)
3) _require&lt;/em&gt;users&lt;em&gt;profile.html.erb:  some stuff from user - rarely displayed
4) _footer.html.erb: static page paths and not much else
5) _round&lt;/em&gt;banners.html.erb: next event stuff&lt;/p&gt;

&lt;p&gt;&lt;code&gt;nearest_time_zone&lt;/code&gt; is tied up with various things for the User and looks like it will be tricky to understand, let alone remove &amp;hellip; re-running it seems like it&amp;rsquo;s only the event portion of the round banners that&amp;rsquo;s giving us memory overhead here.  Weirdly I can&amp;rsquo;t even work out where the event object is coming from &amp;hellip; ah, we have some before_filters in the ApplicationController:&lt;/p&gt;
&lt;pre class="highlight plaintext"&gt;&lt;code&gt;  before_filter :get_next_scrum, :store_location, unless: -&amp;gt; { request.xhr? }

  def get_next_scrum
    @next_event = Event.next_occurrence(:Scrum)
  end
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;which I guess brings us to the main issue for the loading of the home page, which is that we want to display the time to the next event, and that requires working out when the next event is, and we are generating the full schedule from IceCube on the fly each time.  In principle it would be far more efficient to have it so that all events, and their repeats, were stored (say in a db) and then fetched read-only when needed.  They could then be updated on write operations, which would be far less frequent &amp;hellip; but that would be a major refactoring of the system.  If the homepage still wants to include the countdown, then a static site is not going to help much &amp;hellip; hmmm.&lt;/p&gt;
</content>
  </entry>
</feed>
