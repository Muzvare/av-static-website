<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Blog Name</title>
  <subtitle>Blog subtitle</subtitle>
  <id>http://blog.url.com/</id>
  <link href="http://blog.url.com/"/>
  <link href="http://blog.url.com/feed.xml" rel="self"/>
  <updated>2017-11-20T00:00:00+00:00</updated>
  <author>
    <name>Blog Author</name>
  </author>
  <entry>
    <title>AV EcoSystem Review Behind on Reports</title>
    <link rel="alternate" href="http://blog.url.com/2017/11/20/av-ecosystem-review-behind-on-reports/"/>
    <id>http://blog.url.com/2017/11/20/av-ecosystem-review-behind-on-reports/</id>
    <published>2017-11-20T00:00:00+00:00</published>
    <updated>2018-02-05T22:04:08+00:00</updated>
    <author>
      <name>Article Author</name>
    </author>
    <content type="html">&lt;p&gt;&lt;img alt="typewriter" src="/images/../images/reportt.jpg" /&gt;&lt;/p&gt;

&lt;p&gt;Totally distracted by Slack and Email, but more importantly behind on reports.  I was just a couple of days late on the NHS HLP monthly report, but I&amp;rsquo;m now a good weekend behind on the AgileVentures monthly report.  These monthly reports are part of the deal with the AgileVentures trustees for my consulting company providing the core AgileVentures support contract.   I have been working through creating the latest one, but the explosion of new mobs and pairing sessions, and procrastination on my part means there&amp;rsquo;s still a chunk to do.  &lt;/p&gt;

&lt;p&gt;I&amp;rsquo;m also massively behind on my usual checkins with Premium members.  We&amp;rsquo;re trying to move the report around so that it&amp;rsquo;s less detailed stats that take me too long to put together and focuses on the progress of the individual premium members.  I&amp;rsquo;d really like a clear day to review where we are with each individual Premium member.  Having created the initial report structure with lots of details I&amp;rsquo;ve kind of fallen into a trap of trying to replicate those details every month.  Should I then burn time trying to automate parts of the report.   Drop some of those stats?&lt;/p&gt;

&lt;p&gt;I just spent ten minutes getting the stats together for the last month of mobs:&lt;/p&gt;

&lt;p&gt;| Date      | Mob Topic | #Attendees | Names                                                 |
|&amp;mdash;&amp;mdash;&amp;mdash;&amp;ndash;|&amp;mdash;&amp;mdash;&amp;mdash;&amp;ndash;|&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;|&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-|
| 10/13 Fri | React     | 5          | Sam, Fred, Michael and Ose (trial)                    |
| 10/17 Tue | Rspec     | 5          | Federico, Michael, Siba (trial), Brent and Sigu       |
| 10/18 Wed | Elixir    | 6          | Sam, Federico, Ryder, Michael, Sigu and Zmago         |
| 10/20 Fri | React     | 7          | Sam, Federico, Michael, Mikael, Ryder, Zmago and Fred |
| 10/24 Tue | Rspec     | 3          | Federico, Brent, Dennis (trial) and Michael           |
| 10/25 Wed | Elixir    | 6          | Federico, Lara, Ryder, Sigu and Fred                  |
| 10/27 Fri | React     | 4          | Federico, Michael, Mikael and Fred                    |
| 10/31 Tue | Rspec     | 3          | Federico, Brent and Michael                           |
| 11/1  Wed | Elixir    | 3          | Sam, Federico, and Ryder                              |
| 11/3  Fri | React     | 4          | Sam, Federico, Ryder and Fred                         |
| 11/7 Tue  | Rspec     | 4          | Federico, Sigu, Stella and Brent                      |
| 11/8 Wed  | Elixir    | 3          | Sam, Federico and Zmago                               |
| 11/10 Fri | React     | 7          | Sam, Stella, Federico, Mikael, Michael and Fred       |
| 11/13 Mon | WebDev    | 6          | Sam, Michael, Lara, Fiona, Linda, Kiran               |
| 11/14 Tue | RSpec     | 3          | Federico, Stella and Brent                            |
| 11/15 Wed | Elixir    | 3          | Sam, Federico and Zmago                               |
| 11/17 Fri | React     | 4          | Sam, Fred, Michael and Federico                       |
| 11/17 Fri | AduRoR    | 3          | Sam, Brent and Bill                                   |&lt;/p&gt;

&lt;p&gt;Do I need to check with everyone before sharing their first names above? I guess I can run it through an anonymizer if anyone is bothered.  I&amp;rsquo;m keen to share these stats, and I&amp;rsquo;m really keen on transparency, but not everyone wants every part of what they do transparent.  &lt;/p&gt;

&lt;p&gt;Now I&amp;rsquo;ve spent another 10 minutes getting all the data on F2F pairing sessions:&lt;/p&gt;

&lt;p&gt;| Date      | F2F Topic     | Who            |
|&amp;mdash;&amp;mdash;&amp;mdash;&amp;ndash;|&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;|&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-|
| 9/14 Thu  | R/Data Mining | Michael        |
| 9/18 Mon  | Phoenix       | Federico       |
| 10/16 Mon | Phoenix       | Federico       |
| 10/17 Tue | Rails/Jitsi   | Sigu (trial)   |
| 10/17 Tue | Rails         | Will (trial)   |
| 10/31 Tue | Rails         | Ryder          |
| 11/6 Mon  | Rails/React   | Sage (trial)   |
| 11/9 Thu  | R/Data Mining | Michael        |
| 11/10 Fri | Rails         | Brent          |
| 11/12 Sun | Rails         | Piotr (trial)  |
| 11/12 Sun | Rails         | Marian         |
| 11/14 Tue | Rails         | Stella (trial) |
| 11/14 Tue | Rails         | Rose           |
| 11/15 Wed | Rails         | Philip         |
| 11/16 Thu | Phoenix       | Ben (trial)    |
| 11/17 Fri | Phoenix       | Ryder          |&lt;/p&gt;

&lt;p&gt;and so with the work from last week on meetings stats and web stats, I&amp;rsquo;ve finished the main stats part of the report, but not the update of individual Premium members, or reaching out to all the Premiums to check how they are doing.  With my schedule today that&amp;rsquo;ll have to be tomorrow &amp;hellip;&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>AV EcoSystem Review One Thing After Another</title>
    <link rel="alternate" href="http://blog.url.com/2017/11/16/av-ecosystem-review-one-thing-after-another/"/>
    <id>http://blog.url.com/2017/11/16/av-ecosystem-review-one-thing-after-another/</id>
    <published>2017-11-16T00:00:00+00:00</published>
    <updated>2018-02-05T22:01:09+00:00</updated>
    <author>
      <name>Article Author</name>
    </author>
    <content type="html">&lt;p&gt;&lt;img alt="typewriter" src="/images/typewriter.jpg" /&gt;&lt;/p&gt;

&lt;p&gt;Some days it&amp;rsquo;s just one thing after another.  As Wednesday was drawing to a close I was feeling pretty pleased to have fixes out for our Slack invites (confirmed as all the recent sign ups had already been invited this morning), and for one-off events not showing up.  I knew we also had some kind of javascript error affecting the calendar popups on the create event page, but it turns out that some kind of failure in our Google Analytics code is systematically breaking JavaScript througout the site.  I managed to fix that last night by turning off the analytics, but that&amp;rsquo;s a short term fix as we need that working.&lt;/p&gt;

&lt;p&gt;Am I just fire-fighting crazily here?  I&amp;rsquo;m thinking about the requests that Federico put in for RSVPs, alerts when members join projects, Fred asking for the jitsi server &amp;hellip;  Anyway this is systemic and we need to report analytics to the trustees.  I was able to replicate the failure on staging - perhaps I can replicate it locally.  I can trigger the error locally by running the server like so:&lt;/p&gt;
&lt;pre class="highlight plaintext"&gt;&lt;code&gt;ENABLE_GOOGLE_ANALYTICS=true be rails s
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The Jasmine tests work fine, even with analytics enabled:&lt;/p&gt;
&lt;pre class="highlight plaintext"&gt;&lt;code&gt;â†’ ENABLE_GOOGLE_ANALYTICS=true bej
[35019] Puma starting in cluster mode...
[35019] * Version 3.10.0 (ruby 2.3.1-p112), codename: Russell's Teapot
[35019] * Min threads: 1, max threads: 16
[35019] * Environment: development
[35019] * Process workers: 3
[35019] * Preloading application
[35019] * Listening on tcp://0.0.0.0:51775
[35019] Use Ctrl-C to stop
Waiting for jasmine server on 51775...
[35019] - Worker 0 (pid: 35027) booted, phase: 0
[35019] - Worker 1 (pid: 35028) booted, phase: 0
[35019] - Worker 2 (pid: 35029) booted, phase: 0
jasmine server started
.............................................****..........................
Pending:
    eventDatePicker hides event repeat options by default
      awaiting refactor of related form for use in fixture

    eventDatePicker shows event repeat options when event is set to repeat
      awaiting refactor of related form for use in fixture

    eventDatePicker shows event repeat optional ending when event is set to end
      awaiting refactor of related form for use in fixture

    eventDatePicker hides event repeat optional ending when event is set to never end
      awaiting refactor of related form for use in fixture

75 specs, 0 failures, 4 pending specs
Coverage report generated for RSpec to /Users/tansaku/Documents/GitHub/AgileVentures/WebsiteOne/coverage. 122 / 3516 LOC (3.47%) covered.
[35029] ! Detected parent died, dying
[35028] ! Detected parent died, dying
[35027] ! Detected parent died, dying
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The local error is easier to understand:&lt;/p&gt;

&lt;p&gt;&lt;img src="https://dl.dropbox.com/s/xzo0oe3pgnquepo/Screenshot%202017-11-16%2009.52.32.png?dl=0" /&gt;&lt;/p&gt;

&lt;p&gt;and it seems that we can&amp;rsquo;t use the variable &lt;code&gt;ga&lt;/code&gt; in the modified sense in the current google analytics code:&lt;/p&gt;
&lt;pre class="highlight javascript"&gt;&lt;code&gt;&lt;span class="nx"&gt;WebsiteOne&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;define&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'GoogleAnalytics'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_gaq&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[];&lt;/span&gt;
  &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_gaq&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;push&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s1"&gt;'_setAccount'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'UA-47795185-1'&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;ga&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;createElement&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'script'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="nx"&gt;ga&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'text/javascript'&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;ga&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;async&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="nx"&gt;ga&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;src&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'https:'&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;location&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;protocol&lt;/span&gt; &lt;span class="p"&gt;?&lt;/span&gt; &lt;span class="s1"&gt;'https://ssl'&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'http://www'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;'.google-analytics.com/ga.js'&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;s&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementsByTagName&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'script'&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt; &lt;span class="nx"&gt;s&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;parentNode&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;insertBefore&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;ga&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;s&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

  &lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;init&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_gaq&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;push&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s1"&gt;'_trackPageview'&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;GA_LOCAL_STORAGE_KEY&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'ga:clientId'&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="c1"&gt;// the code below leads to the following error&lt;/span&gt;
  &lt;span class="c1"&gt;// Uncaught TypeError: ga is not a function&lt;/span&gt;
  &lt;span class="c1"&gt;//&lt;/span&gt;
  &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;localStorage&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;ga&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'create'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'UA-47795185-1'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="s1"&gt;'storage'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'none'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="s1"&gt;'clientId'&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;localStorage&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getItem&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;GA_LOCAL_STORAGE_KEY&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;});&lt;/span&gt;
    &lt;span class="nx"&gt;ga&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;tracker&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nx"&gt;localStorage&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setItem&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;GA_LOCAL_STORAGE_KEY&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;tracker&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'clientId'&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
    &lt;span class="p"&gt;});&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;ga&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'create'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'UA-47795185-1'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'auto'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="nx"&gt;ga&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'send'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'pageview'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="na"&gt;init&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;init&lt;/span&gt;
  &lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I think what we have here is a mix of old and new GA tracking code, and the problem that none of it actually gets run until we go into production, where google analytics is switched on.  Looking up both old and new code, I can&amp;rsquo;t immediately see a way to reconcile them, so I&amp;rsquo;ve commented out the offending code, and so will get that up until we can work out an effective combined approach.&lt;/p&gt;

&lt;p&gt;I think rather than switching GA code on and off globally we should have different account ids for different instances, and set that via ENV vars &amp;hellip;&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>AV EcoSystem Review Running Repairs</title>
    <link rel="alternate" href="http://blog.url.com/2017/11/15/av-ecosystem-review-running-repairs/"/>
    <id>http://blog.url.com/2017/11/15/av-ecosystem-review-running-repairs/</id>
    <published>2017-11-15T00:00:00+00:00</published>
    <updated>2018-01-31T20:57:47+00:00</updated>
    <author>
      <name>Article Author</name>
    </author>
    <content type="html">&lt;p&gt;&lt;img alt="running repairs" src="/images/running_repairs.jpg" /&gt;&lt;/p&gt;

&lt;p&gt;9:24 am blog face, but no&amp;ndash;9:29 am&amp;ndash;since I got distracted by Slack and email.  Yesterday I rolled out some code to make the automated Slack sign up more robust.  The code is on production now, and so maybe a test from the heroku command line is the way to go &amp;hellip;&lt;/p&gt;
&lt;pre class="highlight shell"&gt;&lt;code&gt;&lt;span class="gp"&gt;irb(main):003:0&amp;gt; &lt;/span&gt;SlackInviteJob.new.perform&lt;span class="o"&gt;(&lt;/span&gt;User.last.email&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt;ActiveJob] &lt;span class="o"&gt;[&lt;/span&gt;ActionMailer::DeliveryJob] &lt;span class="o"&gt;[&lt;/span&gt;ff673d08-8c78-403c-a740-268417c9a4c7] Performing ActionMailer::DeliveryJob from Inline&lt;span class="o"&gt;(&lt;/span&gt;mailers&lt;span class="o"&gt;)&lt;/span&gt; with arguments: &lt;span class="s2"&gt;"AdminMailer"&lt;/span&gt;, &lt;span class="s2"&gt;"failed_to_invite_user_to_slack"&lt;/span&gt;, &lt;span class="s2"&gt;"deliver_now"&lt;/span&gt;, &lt;span class="s2"&gt;"email@email.com"&lt;/span&gt;, nil, &lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="se"&gt;\"&lt;/span&gt;&lt;span class="s2"&gt;already_invited&lt;/span&gt;&lt;span class="se"&gt;\"&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt;ActiveJob] &lt;span class="o"&gt;[&lt;/span&gt;ActionMailer::DeliveryJob] &lt;span class="o"&gt;[&lt;/span&gt;ff673d08-8c78-403c-a740-268417c9a4c7]   Rendered admin_mailer/failed_to_invite_user_to_slack.html.erb within layouts/mailer &lt;span class="o"&gt;(&lt;/span&gt;0.9ms&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt;ActiveJob] &lt;span class="o"&gt;[&lt;/span&gt;ActionMailer::DeliveryJob] &lt;span class="o"&gt;[&lt;/span&gt;ff673d08-8c78-403c-a740-268417c9a4c7] 
Sent mail to support@agileventures.org &lt;span class="o"&gt;(&lt;/span&gt;215.3ms&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt;ActiveJob] &lt;span class="o"&gt;[&lt;/span&gt;ActionMailer::DeliveryJob] &lt;span class="o"&gt;[&lt;/span&gt;ff673d08-8c78-403c-a740-268417c9a4c7] Performed ActionMailer::DeliveryJob from Inline&lt;span class="o"&gt;(&lt;/span&gt;mailers&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="k"&gt;in &lt;/span&gt;386.04ms
&lt;span class="o"&gt;[&lt;/span&gt;ActiveJob] Enqueued ActionMailer::DeliveryJob &lt;span class="o"&gt;(&lt;/span&gt;Job ID: ff673d08-8c78-403c-a740-268417c9a4c7&lt;span class="o"&gt;)&lt;/span&gt; to Inline&lt;span class="o"&gt;(&lt;/span&gt;mailers&lt;span class="o"&gt;)&lt;/span&gt; with arguments: &lt;span class="s2"&gt;"AdminMailer"&lt;/span&gt;, &lt;span class="s2"&gt;"failed_to_invite_user_to_slack"&lt;/span&gt;, &lt;span class="s2"&gt;"deliver_now"&lt;/span&gt;, &lt;span class="s2"&gt;"email@email.com"&lt;/span&gt;, nil, &lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="se"&gt;\"&lt;/span&gt;&lt;span class="s2"&gt;already_invited&lt;/span&gt;&lt;span class="se"&gt;\"&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;
&lt;span class="gp"&gt;=&amp;gt; &lt;/span&gt;&lt;span class="o"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;"ok"&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&amp;gt;false, &lt;span class="s2"&gt;"error"&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&amp;gt;&lt;span class="s2"&gt;"already_invited"&lt;/span&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now that looks like we might be in business.  The most recently signed up member has already been invited, and I get a sensible error message when running the SlackInviteJob from the command line.  Let&amp;rsquo;s see if the last 50 have all been invited?  Seven haven&amp;rsquo;t.  That&amp;rsquo;s the lowest number over the last ten days that I&amp;rsquo;ve been manually inviting.  Those seven could have signed up before the deploy.  The acid test will be tomorrow when we&amp;rsquo;ll see if it&amp;rsquo;s zero. If it&amp;rsquo;s not, there&amp;rsquo;s still something to fix.&lt;/p&gt;

&lt;p&gt;Robert had been making the point that we needed to make it easier for folks to get into Slack and that the page that was the top hit on Google for &amp;ldquo;Agile Ventures Slack&amp;rdquo; was an &lt;a href="https://www.agileventures.org/projects/agileventures-community/documents/introduction-to-the-agileventures-slack-channel"&gt;old one&lt;/a&gt;, so I quickly updated that to ensure it mentioned the new sign up process.&lt;/p&gt;

&lt;p&gt;The other running repair we need to make is on the events system where non-repeating single events are not showing up in the future event list.  Maybe they never did?  We need an acceptance test to expose this.  Something like this:&lt;/p&gt;
&lt;pre class="highlight gherkin"&gt;&lt;code&gt;&lt;span class="nt"&gt;@vcr&lt;/span&gt;
&lt;span class="kd"&gt;Feature&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; List Single Events
  As a site user
  So I can find events relevant to me that are happening now
  I would like to see one off events

  &lt;span class="kn"&gt;Background&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="err"&gt;Given the following projects exist&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
      &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="nv"&gt;title&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="nv"&gt;description&lt;/span&gt;          &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="nv"&gt;pitch&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="nv"&gt;status&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt;
      &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="n"&gt;cs169&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="n"&gt;greetings&lt;/span&gt; &lt;span class="n"&gt;earthlings&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt;       &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="n"&gt;active&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt;
    &lt;span class="err"&gt;Given following events exist&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
      &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="nv"&gt;name&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="nv"&gt;description&lt;/span&gt;      &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="nv"&gt;category&lt;/span&gt;         &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="nv"&gt;start_datetime&lt;/span&gt;          &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="nv"&gt;duration&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="nv"&gt;repeats&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="nv"&gt;time_zone&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="nv"&gt;project&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; 
      &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Once&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Once&lt;/span&gt; &lt;span class="n"&gt;off&lt;/span&gt; &lt;span class="n"&gt;meeting&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Pair&lt;/span&gt; &lt;span class="n"&gt;Programming&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="n"&gt;2016/05/02&lt;/span&gt; &lt;span class="n"&gt;07:00:00&lt;/span&gt; &lt;span class="n"&gt;UTC&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="n"&gt;150&lt;/span&gt;      &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="n"&gt;never&lt;/span&gt;   &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="n"&gt;UTC&lt;/span&gt;       &lt;span class="p"&gt;|&lt;/span&gt;  &lt;span class="n"&gt;cs169&lt;/span&gt;  &lt;span class="p"&gt;|&lt;/span&gt;

  &lt;span class="kn"&gt;Scenario&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; Show correct timezone
    &lt;span class="err"&gt;Given the date is "2016/05/01 09&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="err"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="err"&gt;00&lt;/span&gt; &lt;span class="err"&gt;UTC"&lt;/span&gt;
    &lt;span class="nf"&gt;And&lt;/span&gt; I am on events index page
    &lt;span class="nf"&gt;Then&lt;/span&gt; I should see &lt;span class="s"&gt;"Once"&lt;/span&gt;
    &lt;span class="err"&gt;And the local time element should be set to "2016-05-02T07&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="err"&gt;00&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="err"&gt;00Z"&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;However that passes out of the box, so perhaps there&amp;rsquo;s something about when there are also repeating events in the mix &amp;hellip;?  Maybe I should hook locally on the debugger?  I do that and see that a newly created event is not listed in the upcoming events.  It seems that a newly created single event has it&amp;rsquo;s repeat_ends set to true by default and so it&amp;rsquo;s not captured in the list of future events:&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nc"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;base_future_events&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;project&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;project&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;nil?&lt;/span&gt; &lt;span class="p"&gt;?&lt;/span&gt; &lt;span class="no"&gt;Event&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;future_events&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="no"&gt;Event&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;future_events&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;project_id: &lt;/span&gt;&lt;span class="n"&gt;project&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nc"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;future_events&lt;/span&gt;
    &lt;span class="no"&gt;Event&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'repeat_ends = false OR repeat_ends IS NULL OR repeat_ends_on &amp;gt; ?'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;Time&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;now&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nc"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;upcoming_events&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;project&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kp"&gt;nil&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;events&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Event&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;base_future_events&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;project&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;inject&lt;/span&gt;&lt;span class="p"&gt;([])&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;memo&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
      &lt;span class="n"&gt;memo&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;next_occurrences&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;flatten&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;sort_by&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:time&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="no"&gt;Event&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;remove_past_events&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;events&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;My test was passing because it&amp;rsquo;s not creating the event in the same way that the form does, with &lt;code&gt;repeat_ends&lt;/code&gt; set to true. I adjust the test and it fails, and I can get it to pass with the following change:&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nc"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;future_events&lt;/span&gt;
    &lt;span class="no"&gt;Event&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'repeats = \'never\' OR repeat_ends = false OR repeat_ends IS NULL OR repeat_ends_on &amp;gt; ?'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;Time&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;now&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Is this a new thing?  Maybe this never worked.  A complete overhaul of the events system is certainly in order.  There&amp;rsquo;s so much more clean up here, but let&amp;rsquo;s fix the bleed in production first &amp;hellip;&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>AV EcoSystem Review Catching Everything Possible</title>
    <link rel="alternate" href="http://blog.url.com/2017/11/14/av-ecosystem-review-catching-everything-possible/"/>
    <id>http://blog.url.com/2017/11/14/av-ecosystem-review-catching-everything-possible/</id>
    <published>2017-11-14T00:00:00+00:00</published>
    <updated>2018-01-30T21:02:34+00:00</updated>
    <author>
      <name>Article Author</name>
    </author>
    <content type="html">&lt;p&gt;&lt;img alt="confusion" src="/images/catching.png" /&gt;&lt;/p&gt;

&lt;p&gt;9:20am blogface start - go me!  So I really want to get on to working on jitsi on the server, but I got my teeth into this Slack invite yesterday, and I really want to push up some more robust code that will allow this process of inviting new users into Slack to be re-automated.  Yesterday I seemed to be able to successfully invite someone from the rRails command line on Heroku, which makes it seem like Slack&amp;rsquo;s unofficial admin invite endpoint is still working, but that there is problem with the code when running in production.  Here&amp;rsquo;s the code again:&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SlackInviteJob&lt;/span&gt;
  &lt;span class="kp"&gt;include&lt;/span&gt; &lt;span class="no"&gt;SuckerPunch&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Job&lt;/span&gt;

  &lt;span class="no"&gt;SLACK_INVITE_URL&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'https://agileventures.slack.com/api/users.admin.invite'&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;perform&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;URI&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;parse&lt;/span&gt; &lt;span class="no"&gt;SLACK_INVITE_URL&lt;/span&gt;
    &lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Net&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;HTTP&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;post_form&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="ss"&gt;email: &lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="ss"&gt;channels: &lt;/span&gt;&lt;span class="s1"&gt;'C02G8J689,C0285CSUH,C02AA0ARR'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="ss"&gt;token: &lt;/span&gt;&lt;span class="no"&gt;Slack&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;AUTH_TOKEN&lt;/span&gt;
    &lt;span class="p"&gt;})&lt;/span&gt;
    &lt;span class="n"&gt;error&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kp"&gt;nil&lt;/span&gt;
    &lt;span class="n"&gt;json_response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;parse&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;body&lt;/span&gt;
    &lt;span class="n"&gt;slack_error_message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;json_response&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'error'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;json_response&lt;/span&gt;
  &lt;span class="k"&gt;rescue&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;
    &lt;span class="n"&gt;error&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;
  &lt;span class="k"&gt;ensure&lt;/span&gt;
    &lt;span class="k"&gt;unless&lt;/span&gt; &lt;span class="n"&gt;json_response&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;present?&lt;/span&gt; &lt;span class="n"&gt;and&lt;/span&gt; &lt;span class="n"&gt;json_response&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'ok'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
      &lt;span class="no"&gt;AdminMailer&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;failed_to_invite_user_to_slack&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;error&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;slack_error_message&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;deliver_later&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;There seemed to be some error when calling the AdminMailer &lt;code&gt;ActiveJob::SerializationError: Unsupported argument type: NameError&lt;/code&gt; which I don&amp;rsquo;t understand. I google it and there&amp;rsquo;s an &lt;a href="https://stackoverflow.com/questions/40894727/activejobserializationerror-unsupported-argument-type-time-datetime"&gt;SO post&lt;/a&gt; on how this might be related to JSON not being able to handled by a job.  Possibly the &lt;code&gt;slack_error_message&lt;/code&gt; being a nested JSON object that can&amp;rsquo;t be handled by the AdminMailer.&lt;/p&gt;

&lt;p&gt;The other thing I was seeing was that from the Rails command line the &lt;code&gt;Slack::AUTH_TOKEN&lt;/code&gt; is nil, although it definitely worked in the past.  I see we have a couple of closed tickets for previous fixes of this kind of issue:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;[feature switched off](https://github.com/AgileVentures/WebsiteOne/issues/1434]&lt;/li&gt;
&lt;li&gt;[development token expired](https://github.com/AgileVentures/WebsiteOne/issues/1247]&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I&amp;rsquo;ve renewed the token and the feature is active.  Right now I&amp;rsquo;m struggling with finding a ticket to attach this to.  I think I&amp;rsquo;m going to open a chore just to improve the robustness of the SlackInviteJob:&lt;/p&gt;

&lt;p&gt;&lt;a href="https://github.com/AgileVentures/WebsiteOne/issues/1962"&gt;https://github.com/AgileVentures/WebsiteOne/issues/1962&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;and I started an async vote on that.  I&amp;rsquo;m going to start by reviewing the test for this job:&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="n"&gt;describe&lt;/span&gt; &lt;span class="no"&gt;SlackInviteJob&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;subject&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="no"&gt;SlackInviteJob&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;new&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="n"&gt;let&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:email&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="s1"&gt;'random@random.com'&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="n"&gt;stub_const&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Slack::AUTH_TOKEN'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'test'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s1"&gt;'sends a post request to invite the user to slack and returns the proper response'&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;stub_request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:post&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;SlackInviteJob&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;SLACK_INVITE_URL&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;
        &lt;span class="nf"&gt;to_return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;body: &lt;/span&gt;&lt;span class="s1"&gt;'{"ok": true}'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;subject&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;perform&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'ok'&lt;/span&gt;&lt;span class="p"&gt;]).&lt;/span&gt;&lt;span class="nf"&gt;to&lt;/span&gt; &lt;span class="n"&gt;be_truthy&lt;/span&gt;
    &lt;span class="n"&gt;assert_requested&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:post&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;SlackInviteJob&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;SLACK_INVITE_URL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;times: &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;req&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
      &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;req&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;body&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;to&lt;/span&gt; &lt;span class="n"&gt;eq&lt;/span&gt; &lt;span class="s2"&gt;"email=&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="no"&gt;CGI&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;escape&lt;/span&gt; &lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;amp;channels=&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="no"&gt;CGI&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;escape&lt;/span&gt; &lt;span class="s1"&gt;'C02G8J689,C0285CSUH,C02AA0ARR'&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;amp;token=test"&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="n"&gt;context&lt;/span&gt; &lt;span class="s1"&gt;'when invite attempt fails notify admin'&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;let&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:error&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="no"&gt;StandardError&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;new&lt;/span&gt; &lt;span class="s1"&gt;'boom!'&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;stub_request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:post&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;SlackInviteJob&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;SLACK_INVITE_URL&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;and_raise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;error&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s1"&gt;'sends the email later'&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;AdminMailer&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;to&lt;/span&gt; &lt;span class="n"&gt;receive_message_chain&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:failed_to_invite_user_to_slack&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:deliver_later&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;subject&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;perform&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s1"&gt;'includes information about user and error'&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;allow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;AdminMailer&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;to&lt;/span&gt; &lt;span class="n"&gt;receive_message_chain&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:failed_to_invite_user_to_slack&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:deliver_later&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;AdminMailer&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;to&lt;/span&gt; &lt;span class="n"&gt;receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:failed_to_invite_user_to_slack&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;with&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;error&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kp"&gt;nil&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;subject&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;perform&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="n"&gt;context&lt;/span&gt; &lt;span class="s1"&gt;'when slack response not ok should notify admin'&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;stub_request&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:post&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;SlackInviteJob&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;SLACK_INVITE_URL&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
          &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;to_return&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;body: &lt;/span&gt;&lt;span class="s1"&gt;'{"ok": false, "error": "already invited"}'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s1"&gt;'sends the email later'&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;AdminMailer&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;to&lt;/span&gt; &lt;span class="n"&gt;receive_message_chain&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:failed_to_invite_user_to_slack&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:deliver_later&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;subject&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;perform&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="s1"&gt;'includes information about user and error'&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;allow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;AdminMailer&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;to&lt;/span&gt; &lt;span class="n"&gt;receive_message_chain&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:failed_to_invite_user_to_slack&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;:deliver_later&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;AdminMailer&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;to&lt;/span&gt; &lt;span class="n"&gt;receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:failed_to_invite_user_to_slack&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;with&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kp"&gt;nil&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"already invited"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;subject&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;perform&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;which basically looks okay, and passes locally.  What I&amp;rsquo;m suspicious of is this &lt;code&gt;Slack::AUTH_TOKEN&lt;/code&gt;.  We have a Slack initializer:&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="no"&gt;Slack&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;configure&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;token&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;ENV&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'SLACK_AUTH_TOKEN'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
  &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;logger&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kp"&gt;nil&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;which is part of the &lt;a href="https://github.com/slack-ruby/slack-ruby-client"&gt;SlackRubyClient&lt;/a&gt; that we&amp;rsquo;re using.  There&amp;rsquo;s no mention of &lt;code&gt;Slack::AUTH_TOKEN&lt;/code&gt; in that gem, and locally I can&amp;rsquo;t get it to work, although I can refer to the token directly:&lt;/p&gt;
&lt;pre class="highlight plaintext"&gt;&lt;code&gt;[3] pry(main)&amp;gt; Slack.config
=&amp;gt; Slack::Config
[4] pry(main)&amp;gt; Slack.config.token
=&amp;gt; "xoxb-asdafasdfafafsafsasfasfafsaff"
[5] pry(main)&amp;gt; Slack::AUTH_TOKEN
NameError: uninitialized constant Slack::AUTH_TOKEN
from (pry):5:in `&amp;lt;main&amp;gt;'
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I think I&amp;rsquo;m going to follow my first intuition which was to add dependency injection to this gem rather than stubbing the constant as we do.  Also I guess what we don&amp;rsquo;t have is an acceptance test that might flush out this kind of bug.  Hmm.  Let&amp;rsquo;s start with dependency injection &amp;hellip; I go with:&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;perform&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;token&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Slack&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;token&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="no"&gt;StandardError&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'token is nil'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;token&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;nil?&lt;/span&gt;
    &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;URI&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;parse&lt;/span&gt; &lt;span class="no"&gt;SLACK_INVITE_URL&lt;/span&gt;
    &lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Net&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;HTTP&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;post_form&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="ss"&gt;email: &lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="ss"&gt;channels: &lt;/span&gt;&lt;span class="s1"&gt;'C02G8J689,C0285CSUH,C02AA0ARR'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="ss"&gt;token: &lt;/span&gt;&lt;span class="n"&gt;token&lt;/span&gt;
    &lt;span class="p"&gt;})&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I feel like I want better backup for the AdminMailer, but I am really at a loss as to how to defend against this serialization error.  As I google more I get the sense that the problem may come from trying to serialize the thing to deliver later.  Somehow serialising doesn&amp;rsquo;t work for some data structures and that&amp;rsquo;s needed for &lt;code&gt;deliver_later&lt;/code&gt; so I&amp;rsquo;m going to try with:&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="no"&gt;AdminMailer&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;failed_to_invite_user_to_slack&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;error&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;try&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:to_json&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;slack_error_message&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;try&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:to_json&lt;/span&gt;&lt;span class="p"&gt;)).&lt;/span&gt;&lt;span class="nf"&gt;deliver_later&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;which is now being tested with a partial match:&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;AdminMailer&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;to&lt;/span&gt; &lt;span class="n"&gt;receive&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:failed_to_invite_user_to_slack&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;with&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kp"&gt;nil&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;because running &lt;code&gt;to_json&lt;/code&gt; on the error ends up including the full stack chase and the line numbers will vary from machine to machine, so we just match against a String.  Okay, some progress I think - let&amp;rsquo;s get this into production and see what happens :-)&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>AV EcoSystem Review New Mobs and Communication</title>
    <link rel="alternate" href="http://blog.url.com/2017/11/13/av-ecosystem-review-new-mobs-and-communication/"/>
    <id>http://blog.url.com/2017/11/13/av-ecosystem-review-new-mobs-and-communication/</id>
    <published>2017-11-13T00:00:00+00:00</published>
    <updated>2018-01-30T20:53:19+00:00</updated>
    <author>
      <name>Article Author</name>
    </author>
    <content type="html">&lt;p&gt;&lt;img alt="confusion" src="/images/mob_communication.jpg" /&gt;&lt;/p&gt;

&lt;p&gt;So I&amp;rsquo;m rushing myself to push out the days schedule on the Slack #general channel as I&amp;rsquo;ve scheduled two new mobs to start:&lt;/p&gt;
&lt;pre class="highlight plaintext"&gt;&lt;code&gt;@here (note, all times in UTC)

TODAY'S EVENTS
==============

* 10:30 - 11:30 UTC : WebDev (OdinProject) Mob (for Premium Members - free trial if you like us on fb or follow us on twitter)
* 12:00 - 12:15 UTC : "Martin Fowler" Scrum and Pair Hookup - https://www.agileventures.org/events/martin-fowler-scrum-and-pair-hookup
* 13:00 - 14:00 UTC : Deep Learning Mob (for Premium Members - free trial if you like us on fb or follow us on twitter)
* 15:00 - 16:00 UTC: Phoenix 1.3 Guides Daily Mob (FREE) - 
https://www.agileventures.org/events/phoenix-1-3-guides-daily-mob-free
* 15:00 - 15:45 UTC : BetaSaaSers/AutoGraders client meeting - https://www.agileventures.org/events/autograders-client-meeting
* 16:15 - 16:30 UTC : "Kent Beck" Scrum and Pair Hookup - https://www.agileventures.org/events/kent-beck-scrum-and-pair-hookup
* 16:30 - 17:00 UTC : SHF Sprint review and planning - https://www.agileventures.org/events/shf-sprint-review-and-planning

Full details at: https://www.agileventures.org/events
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I&amp;rsquo;m probably overloading myself.  Sunday afternoon I did two pairing sessions (one paid, one free trial) and the AV Community meeting and I&amp;rsquo;m getting set up for more pairing.  In the community meeting Michael said that mobs are a good source of revenue and that caused me to pause sice I think that while they definitely are a source of revenue, for the amount of time involved in supporting them we&amp;rsquo;re not getting a wonderful return, particularly since we made them weekly and we&amp;rsquo;ve made the Premium mob fee cover attending any of the currently running mobs &amp;hellip;&lt;/p&gt;

&lt;p&gt;I think both the mobs (and the F2F packages - given that they include all the mobs) are extraordinarily good deals compared to the prices of similar services from other online mentoring services; although I guess it&amp;rsquo;s all a matter of opinion.&lt;/p&gt;

&lt;p&gt;Either way I&amp;rsquo;m getting caught between getting station keeping activities done:&lt;/p&gt;

&lt;p&gt;a) manual slack invites
b) manual daily schedule posts to Slack
c) gem upgrades on WSO
d) checking social media for follows for free trials&lt;/p&gt;

&lt;p&gt;and running free trials and then actual mobs and pairing sessions themselves.  I was half expecting to have private paid projects taking up half my time, but that isn&amp;rsquo;t the case at the moment, so I guess it makes sense to ramp up the mobs and pairing to bring in more AV revenue.&lt;/p&gt;

&lt;p&gt;I need to run more Simplify, Eliminate, Delegate, Automate passes on what I&amp;rsquo;m doing.  I&amp;rsquo;m still holding on to posting the schedules myself because of the difficultly automating them.  Although they did seem to start working on another Slack instance, &amp;hellip; but I also like being able to tweak them daily.  Posting them also forces me to think about the schedule.  What I could do quickly this morning is actually try to re-automate the Slack invites.  At least run the task from the heroku production command line.  We&amp;rsquo;ve been using an undocumented endpoint for a year somewhat reliably, but it seems to have broken:&lt;/p&gt;

&lt;p&gt;&lt;a href="https://github.com/slackhq/slack-api-docs/issues/30#issuecomment-341399842"&gt;https://github.com/slackhq/slack-api-docs/issues/30#issuecomment-341399842&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;and so I&amp;rsquo;ve been invited manually through the Slack UI.  Maybe I can see some sort of error if I test via the rails console.  I&amp;rsquo;ve been using the following to get the most recent user emails:&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;last&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;each&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="nb"&gt;puts&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;email&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="kp"&gt;nil&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Here&amp;rsquo;s our invite code:&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SlackInviteJob&lt;/span&gt;
  &lt;span class="kp"&gt;include&lt;/span&gt; &lt;span class="no"&gt;SuckerPunch&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Job&lt;/span&gt;

  &lt;span class="no"&gt;SLACK_INVITE_URL&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'https://agileventures.slack.com/api/users.admin.invite'&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;perform&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;URI&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;parse&lt;/span&gt; &lt;span class="no"&gt;SLACK_INVITE_URL&lt;/span&gt;
    &lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Net&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;HTTP&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;post_form&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="ss"&gt;email: &lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="ss"&gt;channels: &lt;/span&gt;&lt;span class="s1"&gt;'C02G8J689,C0285CSUH,C02AA0ARR'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="ss"&gt;token: &lt;/span&gt;&lt;span class="no"&gt;Slack&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;AUTH_TOKEN&lt;/span&gt;
    &lt;span class="p"&gt;})&lt;/span&gt;
    &lt;span class="n"&gt;error&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kp"&gt;nil&lt;/span&gt;
    &lt;span class="n"&gt;json_response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;parse&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;body&lt;/span&gt;
    &lt;span class="n"&gt;slack_error_message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;json_response&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'error'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;json_response&lt;/span&gt;
  &lt;span class="k"&gt;rescue&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;
    &lt;span class="n"&gt;error&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;
  &lt;span class="k"&gt;ensure&lt;/span&gt;
    &lt;span class="k"&gt;unless&lt;/span&gt; &lt;span class="n"&gt;json_response&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;present?&lt;/span&gt; &lt;span class="n"&gt;and&lt;/span&gt; &lt;span class="n"&gt;json_response&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'ok'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
      &lt;span class="no"&gt;AdminMailer&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;failed_to_invite_user_to_slack&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;email&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;error&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;slack_error_message&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;deliver_later&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="no"&gt;SlackInviteJob&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;new&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nf"&gt;perform&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'guravareddy.jetlee@gmail.com'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Which gives me the following error:&lt;/p&gt;
&lt;pre class="highlight plaintext"&gt;&lt;code&gt;ActiveJob::SerializationError: Unsupported argument type: NameError
    from /app/vendor/bundle/ruby/2.3.0/gems/activejob-4.2.10/lib/active_job/arguments.rb:71:in `serialize_argument'
    from /app/vendor/bundle/ruby/2.3.0/gems/activejob-4.2.10/lib/active_job/arguments.rb:35:in `block in serialize'
    from /app/vendor/bundle/ruby/2.3.0/gems/activejob-4.2.10/lib/active_job/arguments.rb:35:in `map'
    from /app/vendor/bundle/ruby/2.3.0/gems/activejob-4.2.10/lib/active_job/arguments.rb:35:in `serialize'
    from /app/vendor/bundle/ruby/2.3.0/gems/activejob-4.2.10/lib/active_job/core.rb:86:in `serialize_arguments'
    from /app/vendor/bundle/ruby/2.3.0/gems/activejob-4.2.10/lib/active_job/core.rb:72:in `serialize'
    from /app/vendor/bundle/ruby/2.3.0/gems/activejob-4.2.10/lib/active_job/queue_adapters/inline_adapter.rb:14:in `enqueue'
    from /app/vendor/bundle/ruby/2.3.0/gems/activejob-4.2.10/lib/active_job/enqueuing.rb:71:in `block in enqueue'
    from /app/vendor/bundle/ruby/2.3.0/gems/activesupport-4.2.10/lib/active_support/callbacks.rb:117:in `call'
    from /app/vendor/bundle/ruby/2.3.0/gems/activesupport-4.2.10/lib/active_support/callbacks.rb:555:in `block (2 levels) in compile'
    from /app/vendor/bundle/ruby/2.3.0/gems/activesupport-4.2.10/lib/active_support/callbacks.rb:505:in `call'
    from /app/vendor/bundle/ruby/2.3.0/gems/activesupport-4.2.10/lib/active_support/callbacks.rb:498:in `block (2 levels) in around'
    from /app/vendor/bundle/ruby/2.3.0/gems/activesupport-4.2.10/lib/active_support/callbacks.rb:343:in `block (2 levels) in simple'
    from /app/vendor/bundle/ruby/2.3.0/gems/activejob-4.2.10/lib/active_job/logging.rb:14:in `block (3 levels) in &amp;lt;module:Logging&amp;gt;'
    from /app/vendor/bundle/ruby/2.3.0/gems/activejob-4.2.10/lib/active_job/logging.rb:43:in `block in tag_logger'
    from /app/vendor/bundle/ruby/2.3.0/gems/activesupport-4.2.10/lib/active_support/tagged_logging.rb:68:in `block in tagged'
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and that does not make sense to me.  What I&amp;rsquo;d hope is that all the error handling that we&amp;rsquo;ve installed would tell us when things like this are going wrong.  No.  Nor does AirBrake seem to tell us about this kind of stuff.  Configuration is all off I guess.&lt;/p&gt;

&lt;p&gt;Ah, okay, there is a piece of our code in the extended error message:&lt;/p&gt;
&lt;pre class="highlight plaintext"&gt;&lt;code&gt;    from /app/vendor/bundle/ruby/2.3.0/gems/activesupport-4.2.10/lib/active_support/callbacks.rb:92:in `__run_callbacks__'
    from /app/vendor/bundle/ruby/2.3.0/gems/activesupport-4.2.10/lib/active_support/callbacks.rb:778:in `_run_enqueue_callbacks'
    from /app/vendor/bundle/ruby/2.3.0/gems/activesupport-4.2.10/lib/active_support/callbacks.rb:81:in `run_callbacks'
    from /app/vendor/bundle/ruby/2.3.0/gems/activejob-4.2.10/lib/active_job/enqueuing.rb:67:in `enqueue'
    from /app/vendor/bundle/ruby/2.3.0/gems/activejob-4.2.10/lib/active_job/configured_job.rb:13:in `perform_later'
    from /app/vendor/bundle/ruby/2.3.0/gems/actionmailer-4.2.10/lib/action_mailer/message_delivery.rb:112:in `enqueue_delivery'
    from /app/vendor/bundle/ruby/2.3.0/gems/actionmailer-4.2.10/lib/action_mailer/message_delivery.rb:68:in `deliver_later'
    from /app/app/jobs/slack_invite_job.rb:21:in `perform'
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It looks like somehow our AdminMailer is failing &amp;hellip; Can I run the internals directly?  I can and it seems like it worked for me, but interestingly I couldn&amp;rsquo;t get the slack auth token via &lt;code&gt;Slack::AUTH_TOKEN&lt;/code&gt;.  I had to hard code it.  I also tried it with nil, and seemed to be able to get an error message delivered.   I guess we need error catching on the admin mailing, and I need to defend against nil tokens maybe?  Perhaps I can fix that all up tomorrow &amp;hellip;&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>AV EcoSystem Review Confusion Reigns</title>
    <link rel="alternate" href="http://blog.url.com/2017/11/10/av-ecosystem-review-confusion-reigns/"/>
    <id>http://blog.url.com/2017/11/10/av-ecosystem-review-confusion-reigns/</id>
    <published>2017-11-10T00:00:00+00:00</published>
    <updated>2018-01-25T19:23:16+00:00</updated>
    <author>
      <name>Article Author</name>
    </author>
    <content type="html">&lt;p&gt;&lt;img alt="confusion" src="/images/confusion.png" /&gt;&lt;/p&gt;

&lt;p&gt;Hmm, so the last two days I&amp;rsquo;ve adopted a new pattern of focusing first thing not on blogging, but on completing tasks from the previous night that I worry I&amp;rsquo;m not going to get done at all if I prioritize my repeating daily tasks.  It&amp;rsquo;s also partly that my energy is at a massive low this week as I fight off the after-effects of the stomach bug from the weekend.  Adjusting the order of the morning has allowed me to reduce my stress level about repeated procrastination on certain items, and also get out a new google calendar appointment booking system to allow people to book pairing time with me:&lt;/p&gt;

&lt;p&gt;&lt;img src="https://dl.dropbox.com/s/6o1mpaniv0k3u4s/Screenshot%202017-11-10%2011.15.29.png?dl=0" /&gt;&lt;/p&gt;

&lt;p&gt;I&amp;rsquo;ve successfully taken some bookings, but it&amp;rsquo;s not as smooth as I would like.  It appears to require that people accept an email invitation after booking to confirm their slot, which seems rather error prone.  I&amp;rsquo;ve also started pulling in AV events to my Google nonprofit calendar associated with sam@agileventures.org.  I&amp;rsquo;ve been avoiding using Google calendar for a while as I don&amp;rsquo;t like the way it restricts me, but the ad hoc scheduling I&amp;rsquo;ve been using is being overwhelmed by trying to manage all the different pairing bookings.  I&amp;rsquo;d love something integrated smoothly into the AV site, but am giving Google&amp;rsquo;s appointment scheduler a go after seeing that youcanbook.me doesn&amp;rsquo;t have a nonprofit discount and we don&amp;rsquo;t have engineering capacity coming out of our ears at the moment.&lt;/p&gt;

&lt;p&gt;I have to say I&amp;rsquo;m confused about what I&amp;rsquo;m in the middle of doing.  I&amp;rsquo;ve got two personal phone calls I&amp;rsquo;m making in parallel to blogging.  Trying to reduce our car insurance and sort out some personal tax issues.  Both things that involve being on hold for a good long time.  These interminal admin things need to get done, or hundreds of pounds just drifts away &amp;hellip; and I&amp;rsquo;m out of my comfort zone having to listen to tinny hold music instead of my spotify while I write my blog.  Okay, car insurance reduced, yay! No tax refund, boo!&lt;/p&gt;

&lt;p&gt;I totally can&amp;rsquo;t find my list of things that needed to get sorted, but in the WSO meeting I got some agreement that we could try out switching off the next event functionality as a way to check for performance improvements, which makes me think the focus for next week should be on our own jitsi meeting hosting, to see if we can get reliable performance from that and replace hangouts with something that will offer us an API for deeper integration with our site &amp;hellip;&lt;/p&gt;
</content>
  </entry>
</feed>
